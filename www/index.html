<!doctype html><html lang="en"><head><meta charset="UTF-8"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="mobile-web-app-capable" content="yes"/><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/><title>Tiny Tonnetz</title></head><body><app-root></app-root><script>/*! For license information please see app.js.LICENSE.txt */
(()=>{var e,t,n={652:(e,t,n)=>{var s={"./tiny-tonnetz_2.entry.js":[684,684]};function r(e){if(!n.o(s,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=s[e],r=t[0];return n.e(t[1]).then((()=>n(r)))}r.keys=()=>Object.keys(s),r.id=652,e.exports=r},758:(e,t,n)=>{"use strict";n.d(t,{H:()=>L,b:()=>me,g:()=>D,h:()=>T,r:()=>i});var s=Object.defineProperty,r=e=>{if(e.__stencil__getHostRef)return e.__stencil__getHostRef()},i=(e,t)=>{e.__stencil__getHostRef=()=>t,t.$lazyInstance$=e},a=(e,t)=>t in e,o=(e,t)=>(0,console.error)(e,t),l=new Map,c=new Map,d="slot-fb{display:contents}slot-fb[hidden]{display:none}",h="undefined"!=typeof window?window:{},u={$flags$:0,$resourcesUrl$:"",jmp:e=>e(),raf:e=>requestAnimationFrame(e),ael:(e,t,n,s)=>e.addEventListener(t,n,s),rel:(e,t,n,s)=>e.removeEventListener(t,n,s),ce:(e,t)=>new CustomEvent(e,t)},m=(()=>{var e;let t=!1;try{null==(e=h.document)||e.addEventListener("e",null,Object.defineProperty({},"passive",{get(){t=!0}}))}catch(e){}return t})(),p=(()=>{try{return new CSSStyleSheet,"function"==typeof(new CSSStyleSheet).replaceSync}catch(e){}return!1})(),f=!1,g=[],E=[],b=(e,t)=>n=>{e.push(n),f||(f=!0,t&&4&u.$flags$?v(N):u.raf(N))},y=e=>{for(let t=0;t<e.length;t++)try{e[t](performance.now())}catch(e){o(e)}e.length=0},N=()=>{y(g),y(E),(f=g.length>0)&&u.raf(N)},v=e=>Promise.resolve(undefined).then(e),w=b(E,!0),S=e=>"object"==(e=typeof e)||"function"===e;function _(e){var t,n,s;return null!=(s=null==(n=null==(t=e.head)?void 0:t.querySelector('meta[name="csp-nonce"]'))?void 0:n.getAttribute("content"))?s:void 0}((e,t)=>{for(var n in t)s(e,n,{get:t[n],enumerable:!0})})({},{err:()=>M,map:()=>A,ok:()=>$,unwrap:()=>R,unwrapErr:()=>C});var $=e=>({isOk:!0,isErr:!1,value:e}),M=e=>({isOk:!1,isErr:!0,value:e});function A(e,t){if(e.isOk){const n=t(e.value);return n instanceof Promise?n.then((e=>$(e))):$(n)}if(e.isErr){const t=e.value;return M(t)}throw"should never get here"}var I,R=e=>{if(e.isOk)return e.value;throw e.value},C=e=>{if(e.isErr)return e.value;throw e.value},T=(e,t,...n)=>{let s=null,r=null,i=!1,a=!1;const o=[],l=t=>{for(let n=0;n<t.length;n++)s=t[n],Array.isArray(s)?l(s):null!=s&&"boolean"!=typeof s&&((i="function"!=typeof e&&!S(s))&&(s=String(s)),i&&a?o[o.length-1].$text$+=s:o.push(i?O(null,s):s),a=i)};if(l(n),t){t.key&&(r=t.key);{const e=t.className||t.class;e&&(t.class="object"!=typeof e?e:Object.keys(e).filter((t=>e[t])).join(" "))}}const c=O(e,null);return c.$attrs$=t,o.length>0&&(c.$children$=o),c.$key$=r,c},O=(e,t)=>({$flags$:0,$tag$:e,$text$:t,$elm$:null,$children$:null,$attrs$:null,$key$:null}),L={},B=(e,t)=>null==e||S(e)?e:4&t?"false"!==e&&(""===e||!!e):2&t?parseFloat(e):1&t?String(e):e,D=e=>r(e).$hostElement$,P=new WeakMap,U=(e,t)=>"sc-"+e.$tagName$,k=(e,t,n,s,r,i,o)=>{if(n===s)return;let l=a(e,t),c=t.toLowerCase();if("class"===t){const t=e.classList,r=G(n);let i=G(s);t.remove(...r.filter((e=>e&&!i.includes(e)))),t.add(...i.filter((e=>e&&!r.includes(e))))}else if("style"===t){for(const t in n)s&&null!=s[t]||(t.includes("-")?e.style.removeProperty(t):e.style[t]="");for(const t in s)n&&s[t]===n[t]||(t.includes("-")?e.style.setProperty(t,s[t]):e.style[t]=s[t])}else if("key"===t);else if(l||"o"!==t[0]||"n"!==t[1]){const a=S(s);if((l||a&&null!==s)&&!r)try{if(e.tagName.includes("-"))e[t]!==s&&(e[t]=s);else{const r=null==s?"":s;"list"===t?l=!1:null!=n&&e[t]==r||("function"==typeof e.__lookupSetter__(t)?e[t]=r:e.setAttribute(t,r))}}catch(e){}null==s||!1===s?!1===s&&""!==e.getAttribute(t)||e.removeAttribute(t):(!l||4&i||r)&&!a&&1===e.nodeType&&(s=!0===s?"":s,e.setAttribute(t,s))}else if(t="-"===t[2]?t.slice(3):a(h,c)?c.slice(2):c[2]+t.slice(3),n||s){const r=t.endsWith(V);t=t.replace(z,""),n&&u.rel(e,t,n,r),s&&u.ael(e,t,s,r)}},H=/\s/,G=e=>("object"==typeof e&&e&&"baseVal"in e&&(e=e.baseVal),e&&"string"==typeof e?e.split(H):[]),V="Capture",z=new RegExp(V+"$"),x=(e,t,n,s)=>{const r=11===t.$elm$.nodeType&&t.$elm$.host?t.$elm$.host:t.$elm$,i=e&&e.$attrs$||{},a=t.$attrs$||{};for(const e of F(Object.keys(i)))e in a||k(r,e,i[e],void 0,n,t.$flags$);for(const e of F(Object.keys(a)))k(r,e,i[e],a[e],n,t.$flags$)};function F(e){return e.includes("ref")?[...e.filter((e=>"ref"!==e)),"ref"]:e}var j=!1,Y=(e,t,n)=>{const s=t.$children$[n];let r,i,a=0;if(null!==s.$text$)r=s.$elm$=h.document.createTextNode(s.$text$);else{if(j||(j="svg"===s.$tag$),!h.document)throw new Error("You are trying to render a Stencil component in an environment that doesn't support the DOM. Make sure to populate the [`window`](https://developer.mozilla.org/en-US/docs/Web/API/Window/window) object before rendering a component.");if(r=s.$elm$=h.document.createElementNS(j?"http://www.w3.org/2000/svg":"http://www.w3.org/1999/xhtml",s.$tag$),j&&"foreignObject"===s.$tag$&&(j=!1),x(null,s,j),s.$children$)for(a=0;a<s.$children$.length;++a)i=Y(e,s,a),i&&r.appendChild(i);"svg"===s.$tag$?j=!1:"foreignObject"===r.tagName&&(j=!0)}return r["s-hn"]=I,r},q=(e,t,n,s,r,i)=>{let a,o=e;for(o.shadowRoot&&o.tagName===I&&(o=o.shadowRoot);r<=i;++r)s[r]&&(a=Y(null,n,r),a&&(s[r].$elm$=a,Q(o,a,t)))},W=(e,t,n)=>{for(let s=t;s<=n;++s){const t=e[s];if(t){const e=t.$elm$;e&&e.remove()}}},K=(e,t,n=!1)=>e.$tag$===t.$tag$&&(n?(n&&!e.$key$&&t.$key$&&(e.$key$=t.$key$),!0):e.$key$===t.$key$),J=(e,t,n=!1)=>{const s=t.$elm$=e.$elm$,r=e.$children$,i=t.$children$,a=t.$tag$,o=t.$text$;null===o?(x(e,t,j="svg"===a||"foreignObject"!==a&&j),null!==r&&null!==i?((e,t,n,s,r=!1)=>{let i,a,o=0,l=0,c=0,d=0,h=t.length-1,u=t[0],m=t[h],p=s.length-1,f=s[0],g=s[p];for(;o<=h&&l<=p;)if(null==u)u=t[++o];else if(null==m)m=t[--h];else if(null==f)f=s[++l];else if(null==g)g=s[--p];else if(K(u,f,r))J(u,f,r),u=t[++o],f=s[++l];else if(K(m,g,r))J(m,g,r),m=t[--h],g=s[--p];else if(K(u,g,r))J(u,g,r),Q(e,u.$elm$,m.$elm$.nextSibling),u=t[++o],g=s[--p];else if(K(m,f,r))J(m,f,r),Q(e,m.$elm$,u.$elm$),m=t[--h],f=s[++l];else{for(c=-1,d=o;d<=h;++d)if(t[d]&&null!==t[d].$key$&&t[d].$key$===f.$key$){c=d;break}c>=0?(a=t[c],a.$tag$!==f.$tag$?i=Y(t&&t[l],n,c):(J(a,f,r),t[c]=void 0,i=a.$elm$),f=s[++l]):(i=Y(t&&t[l],n,l),f=s[++l]),i&&Q(u.$elm$.parentNode,i,u.$elm$)}o>h?q(e,null==s[p+1]?null:s[p+1].$elm$,n,s,l,p):l>p&&W(t,o,h)})(s,r,t,i,n):null!==i?(null!==e.$text$&&(s.textContent=""),q(s,null,t,i,0,i.length-1)):!n&&null!==r&&W(r,0,r.length-1),j&&"svg"===a&&(j=!1)):e.$text$!==o&&(s.data=o)},Q=(e,t,n)=>null==e?void 0:e.insertBefore(t,n),X=(e,t)=>{if(t&&!e.$onRenderResolve$&&t["s-p"]){const n=t["s-p"].push(new Promise((s=>e.$onRenderResolve$=()=>{t["s-p"].splice(n-1,1),s()})))}},Z=(e,t)=>{if(e.$flags$|=16,!(4&e.$flags$))return X(e,e.$ancestorComponent$),w((()=>ee(e,t)));e.$flags$|=512},ee=(e,t)=>{const n=e.$hostElement$,s=(e.$cmpMeta$.$tagName$,()=>{}),r=e.$lazyInstance$;if(!r)throw new Error(`Can't render component <${n.tagName.toLowerCase()} /> with invalid Stencil runtime! Make sure this imported component is compiled with a \`externalRuntime: true\` flag. For more information, please refer to https://stenciljs.com/docs/custom-elements#externalruntime`);let i;return t?(e.$flags$|=256,e.$queuedListeners$&&(e.$queuedListeners$.map((([e,t])=>oe(r,e,t,n))),e.$queuedListeners$=void 0),i=oe(r,"componentWillLoad",void 0,n)):i=oe(r,"componentWillUpdate",void 0,n),i=te(i,(()=>oe(r,"componentWillRender",void 0,n))),s(),te(i,(()=>se(e,r,t)))},te=(e,t)=>ne(e)?e.then(t).catch((e=>{console.error(e),t()})):t(),ne=e=>e instanceof Promise||e&&e.then&&"function"==typeof e.then,se=async(e,t,n)=>{var s;const r=e.$hostElement$,i=(e.$cmpMeta$.$tagName$,()=>{}),a=r["s-rc"];n&&(e=>{const t=e.$cmpMeta$,n=e.$hostElement$,s=t.$flags$,r=(t.$tagName$,()=>{}),i=((e,t)=>{var n;const s=U(t),r=c.get(s);if(!h.document)return s;if(e=11===e.nodeType?e:h.document,r)if("string"==typeof r){e=e.head||e;let i,a=P.get(e);if(a||P.set(e,a=new Set),!a.has(s)){{i=document.querySelector(`[sty-id="${s}"]`)||h.document.createElement("style"),i.innerHTML=r;const a=null!=(n=u.$nonce$)?n:_(h.document);if(null!=a&&i.setAttribute("nonce",a),!(1&t.$flags$))if("HEAD"===e.nodeName){const t=e.querySelectorAll("link[rel=preconnect]"),n=t.length>0?t[t.length-1].nextSibling:e.querySelector("style");e.insertBefore(i,(null==n?void 0:n.parentNode)===e?n:null)}else if("host"in e)if(p){const t=new CSSStyleSheet;t.replaceSync(r),e.adoptedStyleSheets=[t,...e.adoptedStyleSheets]}else{const t=e.querySelector("style");t?t.innerHTML=r+t.innerHTML:e.prepend(i)}else e.append(i);1&t.$flags$&&e.insertBefore(i,null)}4&t.$flags$&&(i.innerHTML+=d),a&&a.add(s)}}else e.adoptedStyleSheets.includes(r)||(e.adoptedStyleSheets=[...e.adoptedStyleSheets,r]);return s})(n.shadowRoot?n.shadowRoot:n.getRootNode(),t);(10&s&&2&s||128&s)&&(n["s-sc"]=i,n.classList.add(i+"-h")),r()})(e);const o=(e.$cmpMeta$.$tagName$,()=>{});re(e,t,r,n),a&&(a.map((e=>e())),r["s-rc"]=void 0),o(),i();{const t=null!=(s=r["s-p"])?s:[],n=()=>ie(e);0===t.length?n():(Promise.all(t).then(n),e.$flags$|=4,t.length=0)}},re=(e,t,n,s)=>{try{t=t.render(),e.$flags$&=-17,e.$flags$|=2,((e,t,n=!1)=>{const s=e.$hostElement$,r=e.$vnode$||O(null,null),i=(a=t)&&a.$tag$===L?t:T(null,null,t);var a;if(I=s.tagName,n&&i.$attrs$)for(const e of Object.keys(i.$attrs$))s.hasAttribute(e)&&!["key","ref","style","class"].includes(e)&&(i.$attrs$[e]=s[e]);i.$tag$=null,i.$flags$|=4,e.$vnode$=i,i.$elm$=r.$elm$=s.shadowRoot||s,J(r,i,n)})(e,t,s)}catch(t){o(t,e.$hostElement$)}return null},ie=e=>{e.$cmpMeta$.$tagName$;const t=e.$hostElement$,n=e.$lazyInstance$,s=e.$ancestorComponent$;oe(n,"componentDidRender",void 0,t),64&e.$flags$?oe(n,"componentDidUpdate",void 0,t):(e.$flags$|=64,le(t),oe(n,"componentDidLoad",void 0,t),e.$onReadyResolve$(t),s||ae()),e.$onRenderResolve$&&(e.$onRenderResolve$(),e.$onRenderResolve$=void 0),512&e.$flags$&&v((()=>Z(e,!1))),e.$flags$&=-517},ae=e=>{v((()=>(e=>{const t=u.ce("appload",{detail:{namespace:"tiny-midi-web-components"}});return e.dispatchEvent(t),t})(h)))},oe=(e,t,n,s)=>{if(e&&e[t])try{return e[t](n)}catch(e){o(e,s)}},le=e=>e.classList.add("hydrated"),ce=(e,t,n,s)=>{const i=r(e);if(!i)throw new Error(`Couldn't find host element for "${s.$tagName$}" as it is unknown to this Stencil runtime. This usually happens when integrating a 3rd party Stencil component with another Stencil component or application. Please reach out to the maintainers of the 3rd party Stencil component or report this on the Stencil Discord server (https://chat.stenciljs.com) or comment on this similar [GitHub issue](https://github.com/stenciljs/core/issues/5457).`);const a=i.$hostElement$,l=i.$instanceValues$.get(t),c=i.$flags$,d=i.$lazyInstance$;n=B(n,s.$members$[t][0]);const h=Number.isNaN(l)&&Number.isNaN(n);if((!(8&c)||void 0===l)&&n!==l&&!h&&(i.$instanceValues$.set(t,n),d)){if(s.$watchers$&&128&c){const e=s.$watchers$[t];e&&e.map((e=>{try{d[e](n,l,t)}catch(e){o(e,a)}}))}if(2==(18&c)){if(d.componentShouldUpdate&&!1===d.componentShouldUpdate(n,l,t))return;Z(i,!1)}}},de=(e,t,n)=>{var s,i;const a=e.prototype;if(t.$members$||t.$watchers$||e.watchers){e.watchers&&!t.$watchers$&&(t.$watchers$=e.watchers);const o=Object.entries(null!=(s=t.$members$)?s:{});if(o.map((([e,[s]])=>{if(31&s||2&n&&32&s){const{get:i,set:o}=Object.getOwnPropertyDescriptor(a,e)||{};i&&(t.$members$[e][0]|=2048),o&&(t.$members$[e][0]|=4096),(1&n||!i)&&Object.defineProperty(a,e,{get(){{if(!(2048&t.$members$[e][0]))return((e,t)=>r(this).$instanceValues$.get(t))(0,e);const n=r(this),s=n?n.$lazyInstance$:a;if(!s)return;return s[e]}},configurable:!0,enumerable:!0}),Object.defineProperty(a,e,{set(i){const a=r(this);if(o){const n=32&s?this[e]:a.$hostElement$[e];return void 0===n&&a.$instanceValues$.get(e)?i=a.$instanceValues$.get(e):!a.$instanceValues$.get(e)&&n&&a.$instanceValues$.set(e,n),o.apply(this,[B(i,s)]),i=32&s?this[e]:a.$hostElement$[e],void ce(this,e,i,t)}{if(!(1&n&&4096&t.$members$[e][0]))return ce(this,e,i,t),void(1&n&&!a.$lazyInstance$&&a.$onReadyPromise$.then((()=>{4096&t.$members$[e][0]&&a.$lazyInstance$[e]!==a.$instanceValues$.get(e)&&(a.$lazyInstance$[e]=i)})));const r=()=>{const n=a.$lazyInstance$[e];!a.$instanceValues$.get(e)&&n&&a.$instanceValues$.set(e,n),a.$lazyInstance$[e]=B(i,s),ce(this,e,a.$lazyInstance$[e],t)};a.$lazyInstance$?r():a.$onReadyPromise$.then((()=>r()))}}})}})),1&n){const n=new Map;a.attributeChangedCallback=function(e,s,i){u.jmp((()=>{var o;const l=n.get(e);if(this.hasOwnProperty(l))i=this[l],delete this[l];else{if(a.hasOwnProperty(l)&&"number"==typeof this[l]&&this[l]==i)return;if(null==l){const n=r(this),a=null==n?void 0:n.$flags$;if(a&&!(8&a)&&128&a&&i!==s){const r=n.$lazyInstance$,a=null==(o=t.$watchers$)?void 0:o[e];null==a||a.forEach((t=>{null!=r[t]&&r[t].call(r,i,s,e)}))}return}}const c=Object.getOwnPropertyDescriptor(a,l);(i=(null!==i||"boolean"!=typeof this[l])&&i)===this[l]||c.get&&!c.set||(this[l]=i)}))},e.observedAttributes=Array.from(new Set([...Object.keys(null!=(i=t.$watchers$)?i:{}),...o.filter((([e,t])=>15&t[0])).map((([e,t])=>{const s=t[1]||e;return n.set(s,e),s}))]))}}return e},he=(e,t)=>{oe(e,"connectedCallback",void 0,t)},ue=(e,t)=>{oe(e,"disconnectedCallback",void 0,t||e)},me=(e,t={})=>{var s;if(!h.document)return void console.warn("Stencil: No document found. Skipping bootstrapping lazy components.");const i=[],a=t.exclude||[],m=h.customElements,f=h.document.head,g=f.querySelector("meta[charset]"),E=h.document.createElement("style"),b=[];let y,N=!0;Object.assign(u,t),u.$resourcesUrl$=new URL(t.resourcesUrl||"./",h.document.baseURI).href;let v=!1;if(e.map((e=>{e[1].map((t=>{var s;const d={$flags$:t[0],$tagName$:t[1],$members$:t[2],$listeners$:t[3]};4&d.$flags$&&(v=!0),d.$members$=t[2],d.$listeners$=t[3],d.$watchers$=null!=(s=t[4])?s:{};const h=d.$tagName$,f=class extends HTMLElement{constructor(e){if(super(e),this.hasRegisteredEventListeners=!1,((e,t)=>{const n={$flags$:0,$hostElement$:e,$cmpMeta$:t,$instanceValues$:new Map};n.$onReadyPromise$=new Promise((e=>n.$onReadyResolve$=e)),e["s-p"]=[],e["s-rc"]=[];const s=n;e.__stencil__getHostRef=()=>s})(e=this,d),1&d.$flags$)if(e.shadowRoot){if("open"!==e.shadowRoot.mode)throw new Error(`Unable to re-use existing shadow root for ${d.$tagName$}! Mode is set to ${e.shadowRoot.mode} but Stencil only supports open shadow roots.`)}else e.attachShadow({mode:"open"})}connectedCallback(){const e=r(this);this.hasRegisteredEventListeners||(this.hasRegisteredEventListeners=!0,pe(this,e,d.$listeners$)),y&&(clearTimeout(y),y=null),N?b.push(this):u.jmp((()=>(e=>{if(!(1&u.$flags$)){const t=r(e),s=t.$cmpMeta$,i=(s.$tagName$,()=>{});if(1&t.$flags$)pe(e,t,s.$listeners$),(null==t?void 0:t.$lazyInstance$)?he(t.$lazyInstance$,e):(null==t?void 0:t.$onReadyPromise$)&&t.$onReadyPromise$.then((()=>he(t.$lazyInstance$,e)));else{t.$flags$|=1;{let n=e;for(;n=n.parentNode||n.host;)if(n["s-p"]){X(t,t.$ancestorComponent$=n);break}}s.$members$&&Object.entries(s.$members$).map((([t,[n]])=>{if(31&n&&e.hasOwnProperty(t)){const n=e[t];delete e[t],e[t]=n}})),(async(e,t,s)=>{let r;if(!(32&t.$flags$)){if(t.$flags$|=32,s.$lazyBundleId$){const i=((e,t)=>{const s=e.$tagName$.replace(/-/g,"_"),r=e.$lazyBundleId$;if(!r)return;const i=l.get(r);return i?i[s]:n(652)(`./${r}.entry.js`).then((e=>(l.set(r,e),e[s])),(e=>{o(e,t.$hostElement$)}))})(s,t);if(i&&"then"in i){const e=()=>{};r=await i,e()}else r=i;if(!r)throw new Error(`Constructor for "${s.$tagName$}#${t.$modeName$}" was not found`);r.isProxied||(s.$watchers$=r.watchers,de(r,s,2),r.isProxied=!0);const a=(s.$tagName$,()=>{});t.$flags$|=8;try{new r(t)}catch(t){o(t,e)}t.$flags$&=-9,t.$flags$|=128,a(),he(t.$lazyInstance$,e)}else{r=e.constructor;const n=e.localName;customElements.whenDefined(n).then((()=>t.$flags$|=128))}if(r&&r.style){let e;"string"==typeof r.style&&(e=r.style);const t=U(s);if(!c.has(t)){const n=(s.$tagName$,()=>{});((e,t,n)=>{let s=c.get(e);p&&n?(s=s||new CSSStyleSheet,"string"==typeof s?s=t:s.replaceSync(t)):s=t,c.set(e,s)})(t,e,!!(1&s.$flags$)),n()}}}const i=t.$ancestorComponent$,a=()=>Z(t,!0);i&&i["s-rc"]?i["s-rc"].push(a):a()})(e,t,s)}i()}})(this)))}disconnectedCallback(){u.jmp((()=>(async e=>{if(!(1&u.$flags$)){const t=r(e);t.$rmListeners$&&(t.$rmListeners$.map((e=>e())),t.$rmListeners$=void 0),(null==t?void 0:t.$lazyInstance$)?ue(t.$lazyInstance$,e):(null==t?void 0:t.$onReadyPromise$)&&t.$onReadyPromise$.then((()=>ue(t.$lazyInstance$,e)))}P.has(e)&&P.delete(e),e.shadowRoot&&P.has(e.shadowRoot)&&P.delete(e.shadowRoot)})(this))),u.raf((()=>{var e;const t=r(this),n=b.findIndex((e=>e===this));n>-1&&b.splice(n,1),(null==(e=null==t?void 0:t.$vnode$)?void 0:e.$elm$)instanceof Node&&!t.$vnode$.$elm$.isConnected&&delete t.$vnode$.$elm$}))}componentOnReady(){return r(this).$onReadyPromise$}};d.$lazyBundleId$=e[0],a.includes(h)||m.get(h)||(i.push(h),m.define(h,de(f,d,1)))}))})),i.length>0&&(v&&(E.textContent+=d),E.textContent+=i.sort()+"{visibility:hidden}.hydrated{visibility:inherit}",E.innerHTML.length)){E.setAttribute("data-styles","");const e=null!=(s=u.$nonce$)?s:_(h.document);null!=e&&E.setAttribute("nonce",e),f.insertBefore(E,g?g.nextSibling:f.firstChild)}N=!1,b.length?b.map((e=>e.connectedCallback())):u.jmp((()=>y=setTimeout(ae,30)))},pe=(e,t,n,s)=>{n&&h.document&&n.map((([n,s,r])=>{const i=e,a=fe(t,r),o=ge(n);u.ael(i,s,a,o),(t.$rmListeners$=t.$rmListeners$||[]).push((()=>u.rel(i,s,a,o)))}))},fe=(e,t)=>n=>{var s;try{256&e.$flags$?null==(s=e.$lazyInstance$)||s[t](n):(e.$queuedListeners$=e.$queuedListeners$||[]).push([t,n])}catch(t){o(t,e.$hostElement$)}},ge=e=>m?{passive:!!(1&e),capture:!!(2&e)}:!!(2&e)},894:(e,t,n)=>{"use strict";var s,r;n.d(t,{B:()=>a,N:()=>o,S:()=>i,a:()=>r,b:()=>s}),function(e){e.ENGLISH="ENGLISH",e.LATIN="LATIN"}(s||(s={})),function(e){e[e.MINOR_THIRD=3]="MINOR_THIRD",e[e.MAJOR_THIRD=4]="MAJOR_THIRD",e[e.PERFECT_FIFTH=7]="PERFECT_FIFTH"}(r||(r={}));const i=12,a=[1,3,6,8,10];var o;!function(e){e.PRESSED="PRESSED",e.SUSTAINED="SUSTAINED",e.RELEASED="RELEASED"}(o||(o={}))}},s={};function r(e){var t=s[e];if(void 0!==t)return t.exports;var i=s[e]={exports:{}};return n[e](i,i.exports,r),i.exports}r.m=n,r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce(((t,n)=>(r.f[n](e,t),t)),[])),r.u=e=>e+".app.js",r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e={},t="tiny-tonnetz:",r.l=(n,s,i,a)=>{if(e[n])e[n].push(s);else{var o,l;if(void 0!==i)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var h=c[d];if(h.getAttribute("src")==n||h.getAttribute("data-webpack")==t+i){o=h;break}}o||(l=!0,(o=document.createElement("script")).charset="utf-8",o.timeout=120,r.nc&&o.setAttribute("nonce",r.nc),o.setAttribute("data-webpack",t+i),o.src=n),e[n]=[s];var u=(t,s)=>{o.onerror=o.onload=null,clearTimeout(m);var r=e[n];if(delete e[n],o.parentNode&&o.parentNode.removeChild(o),r&&r.forEach((e=>e(s))),t)return t(s)},m=setTimeout(u.bind(null,void 0,{type:"timeout",target:o}),12e4);o.onerror=u.bind(null,o.onerror),o.onload=u.bind(null,o.onload),l&&document.head.appendChild(o)}},r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="",(()=>{var e={792:0};r.f.j=(t,n)=>{var s=r.o(e,t)?e[t]:void 0;if(0!==s)if(s)n.push(s[2]);else{var i=new Promise(((n,r)=>s=e[t]=[n,r]));n.push(s[2]=i);var a=r.p+r.u(t),o=new Error;r.l(a,(n=>{if(r.o(e,t)&&(0!==(s=e[t])&&(e[t]=void 0),s)){var i=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;o.message="Loading chunk "+t+" failed.\n("+i+": "+a+")",o.name="ChunkLoadError",o.type=i,o.request=a,s[1](o)}}),"chunk-"+t,t)}};var t=(t,n)=>{var s,i,[a,o,l]=n,c=0;if(a.some((t=>0!==e[t]))){for(s in o)r.o(o,s)&&(r.m[s]=o[s]);l&&l(r)}for(t&&t(n);c<a.length;c++)i=a[c],r.o(e,i)&&e[i]&&e[i][0](),e[i]=0},n=self.webpackChunktiny_tonnetz=self.webpackChunktiny_tonnetz||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";class e{constructor(e=!1){this.eventMap={},this.eventsSuspended=1==e}addListener(n,s,r={}){if("string"==typeof n&&n.length<1||n instanceof String&&n.length<1||"string"!=typeof n&&!(n instanceof String)&&n!==e.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if("function"!=typeof s)throw new TypeError("The callback must be a function.");const i=new t(n,this,s,r);return this.eventMap[n]||(this.eventMap[n]=[]),r.prepend?this.eventMap[n].unshift(i):this.eventMap[n].push(i),i}addOneTimeListener(e,t,n={}){n.remaining=1,this.addListener(e,t,n)}static get ANY_EVENT(){return Symbol.for("Any event")}hasListener(n,s){return void 0===n?!!(this.eventMap[e.ANY_EVENT]&&this.eventMap[e.ANY_EVENT].length>0)||Object.entries(this.eventMap).some((([,e])=>e.length>0)):!!(this.eventMap[n]&&this.eventMap[n].length>0)&&(s instanceof t?this.eventMap[n].filter((e=>e===s)).length>0:"function"==typeof s?this.eventMap[n].filter((e=>e.callback===s)).length>0:null==s)}get eventNames(){return Object.keys(this.eventMap)}getListeners(e){return this.eventMap[e]||[]}suspendEvent(e){this.getListeners(e).forEach((e=>{e.suspended=!0}))}unsuspendEvent(e){this.getListeners(e).forEach((e=>{e.suspended=!1}))}getListenerCount(e){return this.getListeners(e).length}emit(t,...n){if("string"!=typeof t&&!(t instanceof String))throw new TypeError("The 'event' parameter must be a string.");if(this.eventsSuspended)return;let s=[],r=this.eventMap[e.ANY_EVENT]||[];return this.eventMap[t]&&(r=r.concat(this.eventMap[t])),r.forEach((e=>{if(e.suspended)return;let t=[...n];Array.isArray(e.arguments)&&(t=t.concat(e.arguments)),e.remaining>0&&(s.push(e.callback.apply(e.context,t)),e.count++),--e.remaining<1&&e.remove()})),s}removeListener(e,t,n={}){if(void 0===e)return void(this.eventMap={});if(!this.eventMap[e])return;let s=this.eventMap[e].filter((e=>t&&e.callback!==t||n.remaining&&n.remaining!==e.remaining||n.context&&n.context!==e.context));s.length?this.eventMap[e]=s:delete this.eventMap[e]}async waitFor(e,t={}){return t.duration=parseInt(t.duration),(isNaN(t.duration)||t.duration<=0)&&(t.duration=1/0),new Promise(((n,s)=>{let r,i=this.addListener(e,(()=>{clearTimeout(r),n()}),{remaining:1});t.duration!==1/0&&(r=setTimeout((()=>{i.remove(),s("The duration expired before the event was emitted.")}),t.duration))}))}get eventCount(){return Object.keys(this.eventMap).length}}class t{constructor(t,n,s,r={}){if("string"!=typeof t&&!(t instanceof String)&&t!==e.ANY_EVENT)throw new TypeError("The 'event' parameter must be a string or EventEmitter.ANY_EVENT.");if(!n)throw new ReferenceError("The 'target' parameter is mandatory.");if("function"!=typeof s)throw new TypeError("The 'callback' must be a function.");void 0===r.arguments||Array.isArray(r.arguments)||(r.arguments=[r.arguments]),(r=Object.assign({context:n,remaining:1/0,arguments:void 0,duration:1/0},r)).duration!==1/0&&setTimeout((()=>this.remove()),r.duration),this.arguments=r.arguments,this.callback=s,this.context=r.context,this.count=0,this.event=t,this.remaining=parseInt(r.remaining)>=1?parseInt(r.remaining):1/0,this.suspended=!1,this.target=n}remove(){this.target.removeListener(this.event,this.callback,{context:this.context,remaining:this.remaining})}}class n{static get MIDI_CHANNEL_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MESSAGES enum instead."),n.CHANNEL_MESSAGES}static get CHANNEL_MESSAGES(){return{noteoff:8,noteon:9,keyaftertouch:10,controlchange:11,programchange:12,channelaftertouch:13,pitchbend:14}}static get CHANNEL_NUMBERS(){return[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get MIDI_CHANNEL_NUMBERS(){return this.validation&&console.warn("The MIDI_CHANNEL_NUMBERS array has been deprecated. Use the Enumerations.CHANNEL_NUMBERS array instead."),[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}static get CHANNEL_MODE_MESSAGES(){return{allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been deprecated. Use the Enumerations.CHANNEL_MODE_MESSAGES enum instead."),n.CHANNEL_MODE_MESSAGES}static get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been deprecated. Use the Enumerations.CONTROL_CHANGE_MESSAGES array instead."),{bankselectcoarse:0,modulationwheelcoarse:1,breathcontrollercoarse:2,controller3:3,footcontrollercoarse:4,portamentotimecoarse:5,dataentrycoarse:6,volumecoarse:7,balancecoarse:8,controller9:9,pancoarse:10,expressioncoarse:11,effectcontrol1coarse:12,effectcontrol2coarse:13,controller14:14,controller15:15,generalpurposeslider1:16,generalpurposeslider2:17,generalpurposeslider3:18,generalpurposeslider4:19,controller20:20,controller21:21,controller22:22,controller23:23,controller24:24,controller25:25,controller26:26,controller27:27,controller28:28,controller29:29,controller30:30,controller31:31,bankselectfine:32,modulationwheelfine:33,breathcontrollerfine:34,controller35:35,footcontrollerfine:36,portamentotimefine:37,dataentryfine:38,volumefine:39,balancefine:40,controller41:41,panfine:42,expressionfine:43,effectcontrol1fine:44,effectcontrol2fine:45,controller46:46,controller47:47,controller48:48,controller49:49,controller50:50,controller51:51,controller52:52,controller53:53,controller54:54,controller55:55,controller56:56,controller57:57,controller58:58,controller59:59,controller60:60,controller61:61,controller62:62,controller63:63,holdpedal:64,portamento:65,sustenutopedal:66,softpedal:67,legatopedal:68,hold2pedal:69,soundvariation:70,resonance:71,soundreleasetime:72,soundattacktime:73,brightness:74,soundcontrol6:75,soundcontrol7:76,soundcontrol8:77,soundcontrol9:78,soundcontrol10:79,generalpurposebutton1:80,generalpurposebutton2:81,generalpurposebutton3:82,generalpurposebutton4:83,controller84:84,controller85:85,controller86:86,controller87:87,controller88:88,controller89:89,controller90:90,reverblevel:91,tremololevel:92,choruslevel:93,celestelevel:94,phaserlevel:95,databuttonincrement:96,databuttondecrement:97,nonregisteredparametercoarse:98,nonregisteredparameterfine:99,registeredparametercoarse:100,registeredparameterfine:101,controller102:102,controller103:103,controller104:104,controller105:105,controller106:106,controller107:107,controller108:108,controller109:109,controller110:110,controller111:111,controller112:112,controller113:113,controller114:114,controller115:115,controller116:116,controller117:117,controller118:118,controller119:119,allsoundoff:120,resetallcontrollers:121,localcontrol:122,allnotesoff:123,omnimodeoff:124,omnimodeon:125,monomodeon:126,polymodeon:127}}static get CONTROL_CHANGE_MESSAGES(){return[{number:0,name:"bankselectcoarse",description:"Bank Select (Coarse)",position:"msb"},{number:1,name:"modulationwheelcoarse",description:"Modulation Wheel (Coarse)",position:"msb"},{number:2,name:"breathcontrollercoarse",description:"Breath Controller (Coarse)",position:"msb"},{number:3,name:"controller3",description:"Undefined",position:"msb"},{number:4,name:"footcontrollercoarse",description:"Foot Controller (Coarse)",position:"msb"},{number:5,name:"portamentotimecoarse",description:"Portamento Time (Coarse)",position:"msb"},{number:6,name:"dataentrycoarse",description:"Data Entry (Coarse)",position:"msb"},{number:7,name:"volumecoarse",description:"Channel Volume (Coarse)",position:"msb"},{number:8,name:"balancecoarse",description:"Balance (Coarse)",position:"msb"},{number:9,name:"controller9",description:"Controller 9 (Coarse)",position:"msb"},{number:10,name:"pancoarse",description:"Pan (Coarse)",position:"msb"},{number:11,name:"expressioncoarse",description:"Expression Controller (Coarse)",position:"msb"},{number:12,name:"effectcontrol1coarse",description:"Effect Control 1 (Coarse)",position:"msb"},{number:13,name:"effectcontrol2coarse",description:"Effect Control 2 (Coarse)",position:"msb"},{number:14,name:"controller14",description:"Undefined",position:"msb"},{number:15,name:"controller15",description:"Undefined",position:"msb"},{number:16,name:"generalpurposecontroller1",description:"General Purpose Controller 1 (Coarse)",position:"msb"},{number:17,name:"generalpurposecontroller2",description:"General Purpose Controller 2 (Coarse)",position:"msb"},{number:18,name:"generalpurposecontroller3",description:"General Purpose Controller 3 (Coarse)",position:"msb"},{number:19,name:"generalpurposecontroller4",description:"General Purpose Controller 4 (Coarse)",position:"msb"},{number:20,name:"controller20",description:"Undefined",position:"msb"},{number:21,name:"controller21",description:"Undefined",position:"msb"},{number:22,name:"controller22",description:"Undefined",position:"msb"},{number:23,name:"controller23",description:"Undefined",position:"msb"},{number:24,name:"controller24",description:"Undefined",position:"msb"},{number:25,name:"controller25",description:"Undefined",position:"msb"},{number:26,name:"controller26",description:"Undefined",position:"msb"},{number:27,name:"controller27",description:"Undefined",position:"msb"},{number:28,name:"controller28",description:"Undefined",position:"msb"},{number:29,name:"controller29",description:"Undefined",position:"msb"},{number:30,name:"controller30",description:"Undefined",position:"msb"},{number:31,name:"controller31",description:"Undefined",position:"msb"},{number:32,name:"bankselectfine",description:"Bank Select (Fine)",position:"lsb"},{number:33,name:"modulationwheelfine",description:"Modulation Wheel (Fine)",position:"lsb"},{number:34,name:"breathcontrollerfine",description:"Breath Controller (Fine)",position:"lsb"},{number:35,name:"controller35",description:"Undefined",position:"lsb"},{number:36,name:"footcontrollerfine",description:"Foot Controller (Fine)",position:"lsb"},{number:37,name:"portamentotimefine",description:"Portamento Time (Fine)",position:"lsb"},{number:38,name:"dataentryfine",description:"Data Entry (Fine)",position:"lsb"},{number:39,name:"channelvolumefine",description:"Channel Volume (Fine)",position:"lsb"},{number:40,name:"balancefine",description:"Balance (Fine)",position:"lsb"},{number:41,name:"controller41",description:"Undefined",position:"lsb"},{number:42,name:"panfine",description:"Pan (Fine)",position:"lsb"},{number:43,name:"expressionfine",description:"Expression Controller (Fine)",position:"lsb"},{number:44,name:"effectcontrol1fine",description:"Effect control 1 (Fine)",position:"lsb"},{number:45,name:"effectcontrol2fine",description:"Effect control 2 (Fine)",position:"lsb"},{number:46,name:"controller46",description:"Undefined",position:"lsb"},{number:47,name:"controller47",description:"Undefined",position:"lsb"},{number:48,name:"controller48",description:"General Purpose Controller 1 (Fine)",position:"lsb"},{number:49,name:"controller49",description:"General Purpose Controller 2 (Fine)",position:"lsb"},{number:50,name:"controller50",description:"General Purpose Controller 3 (Fine)",position:"lsb"},{number:51,name:"controller51",description:"General Purpose Controller 4 (Fine)",position:"lsb"},{number:52,name:"controller52",description:"Undefined",position:"lsb"},{number:53,name:"controller53",description:"Undefined",position:"lsb"},{number:54,name:"controller54",description:"Undefined",position:"lsb"},{number:55,name:"controller55",description:"Undefined",position:"lsb"},{number:56,name:"controller56",description:"Undefined",position:"lsb"},{number:57,name:"controller57",description:"Undefined",position:"lsb"},{number:58,name:"controller58",description:"Undefined",position:"lsb"},{number:59,name:"controller59",description:"Undefined",position:"lsb"},{number:60,name:"controller60",description:"Undefined",position:"lsb"},{number:61,name:"controller61",description:"Undefined",position:"lsb"},{number:62,name:"controller62",description:"Undefined",position:"lsb"},{number:63,name:"controller63",description:"Undefined",position:"lsb"},{number:64,name:"damperpedal",description:"Damper Pedal On/Off"},{number:65,name:"portamento",description:"Portamento On/Off"},{number:66,name:"sostenuto",description:"Sostenuto On/Off"},{number:67,name:"softpedal",description:"Soft Pedal On/Off"},{number:68,name:"legatopedal",description:"Legato Pedal On/Off"},{number:69,name:"hold2",description:"Hold 2 On/Off"},{number:70,name:"soundvariation",description:"Sound Variation",position:"lsb"},{number:71,name:"resonance",description:"Resonance",position:"lsb"},{number:72,name:"releasetime",description:"Release Time",position:"lsb"},{number:73,name:"attacktime",description:"Attack Time",position:"lsb"},{number:74,name:"brightness",description:"Brightness",position:"lsb"},{number:75,name:"decaytime",description:"Decay Time",position:"lsb"},{number:76,name:"vibratorate",description:"Vibrato Rate",position:"lsb"},{number:77,name:"vibratodepth",description:"Vibrato Depth",position:"lsb"},{number:78,name:"vibratodelay",description:"Vibrato Delay",position:"lsb"},{number:79,name:"controller79",description:"Undefined",position:"lsb"},{number:80,name:"generalpurposecontroller5",description:"General Purpose Controller 5",position:"lsb"},{number:81,name:"generalpurposecontroller6",description:"General Purpose Controller 6",position:"lsb"},{number:82,name:"generalpurposecontroller7",description:"General Purpose Controller 7",position:"lsb"},{number:83,name:"generalpurposecontroller8",description:"General Purpose Controller 8",position:"lsb"},{number:84,name:"portamentocontrol",description:"Portamento Control",position:"lsb"},{number:85,name:"controller85",description:"Undefined"},{number:86,name:"controller86",description:"Undefined"},{number:87,name:"controller87",description:"Undefined"},{number:88,name:"highresolutionvelocityprefix",description:"High Resolution Velocity Prefix",position:"lsb"},{number:89,name:"controller89",description:"Undefined"},{number:90,name:"controller90",description:"Undefined"},{number:91,name:"effect1depth",description:"Effects 1 Depth (Reverb Send Level)"},{number:92,name:"effect2depth",description:"Effects 2 Depth"},{number:93,name:"effect3depth",description:"Effects 3 Depth (Chorus Send Level)"},{number:94,name:"effect4depth",description:"Effects 4 Depth"},{number:95,name:"effect5depth",description:"Effects 5 Depth"},{number:96,name:"dataincrement",description:"Data Increment"},{number:97,name:"datadecrement",description:"Data Decrement"},{number:98,name:"nonregisteredparameterfine",description:"Non-Registered Parameter Number (Fine)",position:"lsb"},{number:99,name:"nonregisteredparametercoarse",description:"Non-Registered Parameter Number (Coarse)",position:"msb"},{number:100,name:"registeredparameterfine",description:"Registered Parameter Number (Fine)",position:"lsb"},{number:101,name:"registeredparametercoarse",description:"Registered Parameter Number (Coarse)",position:"msb"},{number:102,name:"controller102",description:"Undefined"},{number:103,name:"controller103",description:"Undefined"},{number:104,name:"controller104",description:"Undefined"},{number:105,name:"controller105",description:"Undefined"},{number:106,name:"controller106",description:"Undefined"},{number:107,name:"controller107",description:"Undefined"},{number:108,name:"controller108",description:"Undefined"},{number:109,name:"controller109",description:"Undefined"},{number:110,name:"controller110",description:"Undefined"},{number:111,name:"controller111",description:"Undefined"},{number:112,name:"controller112",description:"Undefined"},{number:113,name:"controller113",description:"Undefined"},{number:114,name:"controller114",description:"Undefined"},{number:115,name:"controller115",description:"Undefined"},{number:116,name:"controller116",description:"Undefined"},{number:117,name:"controller117",description:"Undefined"},{number:118,name:"controller118",description:"Undefined"},{number:119,name:"controller119",description:"Undefined"},{number:120,name:"allsoundoff",description:"All Sound Off"},{number:121,name:"resetallcontrollers",description:"Reset All Controllers"},{number:122,name:"localcontrol",description:"Local Control On/Off"},{number:123,name:"allnotesoff",description:"All Notes Off"},{number:124,name:"omnimodeoff",description:"Omni Mode Off"},{number:125,name:"omnimodeon",description:"Omni Mode On"},{number:126,name:"monomodeon",description:"Mono Mode On"},{number:127,name:"polymodeon",description:"Poly Mode On"}]}static get REGISTERED_PARAMETERS(){return{pitchbendrange:[0,0],channelfinetuning:[0,1],channelcoarsetuning:[0,2],tuningprogram:[0,3],tuningbank:[0,4],modulationrange:[0,5],azimuthangle:[61,0],elevationangle:[61,1],gain:[61,2],distanceratio:[61,3],maximumdistance:[61,4],maximumdistancegain:[61,5],referencedistanceratio:[61,6],panspreadangle:[61,7],rollangle:[61,8]}}static get MIDI_REGISTERED_PARAMETERS(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETERS enum has been deprecated. Use the Enumerations.REGISTERED_PARAMETERS enum instead."),n.MIDI_REGISTERED_PARAMETERS}static get SYSTEM_MESSAGES(){return{sysex:240,timecode:241,songposition:242,songselect:243,tunerequest:246,tuningrequest:246,sysexend:247,clock:248,start:250,continue:251,stop:252,activesensing:254,reset:255,midimessage:0,unknownsystemmessage:-1}}static get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been deprecated. Use the Enumerations.SYSTEM_MESSAGES enum instead."),n.SYSTEM_MESSAGES}static get CHANNEL_EVENTS(){return["noteoff","controlchange","noteon","keyaftertouch","programchange","channelaftertouch","pitchbend","allnotesoff","allsoundoff","localcontrol","monomode","omnimode","resetallcontrollers","nrpn","nrpn-dataentrycoarse","nrpn-dataentryfine","nrpn-dataincrement","nrpn-datadecrement","rpn","rpn-dataentrycoarse","rpn-dataentryfine","rpn-dataincrement","rpn-datadecrement","nrpn-databuttonincrement","nrpn-databuttondecrement","rpn-databuttonincrement","rpn-databuttondecrement"]}}class s{constructor(e,t={}){this.duration=u.defaults.note.duration,this.attack=u.defaults.note.attack,this.release=u.defaults.note.release,null!=t.duration&&(this.duration=t.duration),null!=t.attack&&(this.attack=t.attack),null!=t.rawAttack&&(this.attack=i.from7bitToFloat(t.rawAttack)),null!=t.release&&(this.release=t.release),null!=t.rawRelease&&(this.release=i.from7bitToFloat(t.rawRelease)),Number.isInteger(e)?this.identifier=i.toNoteIdentifier(e):this.identifier=e}get identifier(){return this._name+(this._accidental||"")+this._octave}set identifier(e){const t=i.getNoteDetails(e);if(u.validation&&!e)throw new Error("Invalid note identifier");this._name=t.name,this._accidental=t.accidental,this._octave=t.octave}get name(){return this._name}set name(e){if(u.validation&&(e=e.toUpperCase(),!["C","D","E","F","G","A","B"].includes(e)))throw new Error("Invalid name value");this._name=e}get accidental(){return this._accidental}set accidental(e){if(u.validation&&(e=e.toLowerCase(),!["#","##","b","bb"].includes(e)))throw new Error("Invalid accidental value");this._accidental=e}get octave(){return this._octave}set octave(e){if(u.validation&&(e=parseInt(e),isNaN(e)))throw new Error("Invalid octave value");this._octave=e}get duration(){return this._duration}set duration(e){if(u.validation&&(e=parseFloat(e),isNaN(e)||null===e||e<0))throw new RangeError("Invalid duration value.");this._duration=e}get attack(){return this._attack}set attack(e){if(u.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid attack value.");this._attack=e}get release(){return this._release}set release(e){if(u.validation&&(e=parseFloat(e),isNaN(e)||!(e>=0&&e<=1)))throw new RangeError("Invalid release value.");this._release=e}get rawAttack(){return i.fromFloatTo7Bit(this._attack)}set rawAttack(e){this._attack=i.from7bitToFloat(e)}get rawRelease(){return i.fromFloatTo7Bit(this._release)}set rawRelease(e){this._release=i.from7bitToFloat(e)}get number(){return i.toNoteNumber(this.identifier)}getOffsetNumber(e=0,t=0){return u.validation&&(e=parseInt(e)||0,t=parseInt(t)||0),Math.min(Math.max(this.number+12*e+t,0),127)}}class i{static toNoteNumber(e,t=0){if(t=null==t?0:parseInt(t),isNaN(t))throw new RangeError("Invalid 'octaveOffset' value");"string"!=typeof e&&(e="");const n=this.getNoteDetails(e);if(!n)throw new TypeError("Invalid note identifier");let s=12*(n.octave+1+t);if(s+={C:0,D:2,E:4,F:5,G:7,A:9,B:11}[n.name],n.accidental&&(n.accidental.startsWith("b")?s-=n.accidental.length:s+=n.accidental.length),s<0||s>127)throw new RangeError("Invalid octaveOffset value");return s}static getNoteDetails(e){Number.isInteger(e)&&(e=this.toNoteIdentifier(e));const t=e.match(/^([CDEFGAB])(#{0,2}|b{0,2})(-?\d+)$/i);if(!t)throw new TypeError("Invalid note identifier");const n=t[1].toUpperCase(),s=parseInt(t[3]);let r=t[2].toLowerCase();return r=""===r?void 0:r,{accidental:r,identifier:n+(r||"")+s,name:n,octave:s}}static sanitizeChannels(e){let t;if(u.validation)if("all"===e)t=["all"];else if("none"===e)return[];return t=Array.isArray(e)?e:[e],t.indexOf("all")>-1&&(t=n.MIDI_CHANNEL_NUMBERS),t.map((function(e){return parseInt(e)})).filter((function(e){return e>=1&&e<=16}))}static toTimestamp(e){let t=!1;const n=parseFloat(e);return!isNaN(n)&&("string"==typeof e&&"+"===e.substring(0,1)?n>=0&&(t=u.time+n):n>=0&&(t=n),t)}static guessNoteNumber(e,t){t=parseInt(t)||0;let n=!1;if(Number.isInteger(e)&&e>=0&&e<=127)n=parseInt(e);else if(parseInt(e)>=0&&parseInt(e)<=127)n=parseInt(e);else if("string"==typeof e||e instanceof String)try{n=this.toNoteNumber(e.trim(),t)}catch(e){return!1}return n}static toNoteIdentifier(e,t){if(e=parseInt(e),isNaN(e)||e<0||e>127)throw new RangeError("Invalid note number");if(t=null==t?0:parseInt(t),isNaN(t))throw new RangeError("Invalid octaveOffset value");const n=Math.floor(e/12-1)+t;return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]+n.toString()}static buildNote(e,t={}){if(t.octaveOffset=parseInt(t.octaveOffset)||0,e instanceof s)return e;let n=this.guessNoteNumber(e,t.octaveOffset);if(!1===n)throw new TypeError(`The input could not be parsed as a note (${e})`);return t.octaveOffset=void 0,new s(n,t)}static buildNoteArray(e,t={}){let n=[];return Array.isArray(e)||(e=[e]),e.forEach((e=>{n.push(this.buildNote(e,t))})),n}static from7bitToFloat(e){return e===1/0&&(e=127),e=parseInt(e)||0,Math.min(Math.max(e/127,0),1)}static fromFloatTo7Bit(e){return e===1/0&&(e=1),e=parseFloat(e)||0,Math.min(Math.max(Math.round(127*e),0),127)}static fromMsbLsbToFloat(e,t=0){u.validation&&(e=Math.min(Math.max(parseInt(e)||0,0),127),t=Math.min(Math.max(parseInt(t)||0,0),127));const n=((e<<7)+t)/16383;return Math.min(Math.max(n,0),1)}static fromFloatToMsbLsb(e){u.validation&&(e=Math.min(Math.max(parseFloat(e)||0,0),1));const t=Math.round(16383*e);return{msb:t>>7,lsb:127&t}}static offsetNumber(e,t=0,n=0){if(u.validation){if(e=parseInt(e),isNaN(e))throw new Error("Invalid note number");t=parseInt(t)||0,n=parseInt(n)||0}return Math.min(Math.max(e+12*t+n,0),127)}static getPropertyByValue(e,t){return Object.keys(e).find((n=>e[n]===t))}static getCcNameByNumber(e){if(!u.validation||(e=parseInt(e))>=0&&e<=127)return n.CONTROL_CHANGE_MESSAGES[e].name}static getCcNumberByName(e){let t=n.CONTROL_CHANGE_MESSAGES.find((t=>t.name===e));return t?t.number:n.MIDI_CONTROL_CHANGE_MESSAGES[e]}static getChannelModeByNumber(e){if(!(e>=120&&e<=127))return!1;for(let t in n.CHANNEL_MODE_MESSAGES)if(n.CHANNEL_MODE_MESSAGES.hasOwnProperty(t)&&e===n.CHANNEL_MODE_MESSAGES[t])return t;return!1}static get isNode(){return"undefined"!=typeof process&&null!=process.versions&&null!=process.versions.node}static get isBrowser(){return"undefined"!=typeof window&&void 0!==window.document}}class a extends e{constructor(e,t){super(),this._output=e,this._number=t,this._octaveOffset=0}destroy(){this._output=null,this._number=null,this._octaveOffset=0,this.removeListener()}send(e,t={time:0}){return this.output.send(e,t),this}sendKeyAftertouch(e,t,s={}){if(u.validation){if(s.useRawValue&&(s.rawValue=s.useRawValue),isNaN(parseFloat(t)))throw new RangeError("Invalid key aftertouch value.");if(s.rawValue){if(!(t>=0&&t<=127&&Number.isInteger(t)))throw new RangeError("Key aftertouch raw value must be an integer between 0 and 127.")}else if(!(t>=0&&t<=1))throw new RangeError("Key aftertouch value must be a float between 0 and 1.")}s.rawValue||(t=i.fromFloatTo7Bit(t));const r=u.octaveOffset+this.output.octaveOffset+this.octaveOffset;return Array.isArray(e)||(e=[e]),i.buildNoteArray(e).forEach((e=>{this.send([(n.CHANNEL_MESSAGES.keyaftertouch<<4)+(this.number-1),e.getOffsetNumber(r),t],{time:i.toTimestamp(s.time)})})),this}sendControlChange(e,t,s={}){if("string"==typeof e&&(e=i.getCcNumberByName(e)),Array.isArray(t)||(t=[t]),u.validation){if(void 0===e)throw new TypeError("Control change must be identified with a valid name or an integer between 0 and 127.");if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new TypeError("Control change number must be an integer between 0 and 127.");if(2===(t=t.map((e=>{const t=Math.min(Math.max(parseInt(e),0),127);if(isNaN(t))throw new TypeError("Values must be integers between 0 and 127");return t}))).length&&e>=32)throw new TypeError("To use a value array, the controller must be between 0 and 31")}return t.forEach(((r,a)=>{this.send([(n.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e+32*a,t[a]],{time:i.toTimestamp(s.time)})})),this}_selectNonRegisteredParameter(e,t={}){return this.sendControlChange(99,e[0],t),this.sendControlChange(98,e[1],t),this}_deselectRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_deselectNonRegisteredParameter(e={}){return this.sendControlChange(101,127,e),this.sendControlChange(100,127,e),this}_selectRegisteredParameter(e,t={}){return this.sendControlChange(101,e[0],t),this.sendControlChange(100,e[1],t),this}_setCurrentParameter(e,t={}){return e=[].concat(e),this.sendControlChange(6,e[0],t),e.length<2||this.sendControlChange(38,e[1],t),this}sendRpnDecrement(e,t={}){if(Array.isArray(e)||(e=n.REGISTERED_PARAMETERS[e]),u.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(n.REGISTERED_PARAMETERS).forEach((s=>{n.REGISTERED_PARAMETERS[s][0]===e[0]&&n.REGISTERED_PARAMETERS[s][1]===e[1]&&(t=!0)})),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(97,0,t),this._deselectRegisteredParameter(t),this}sendRpnIncrement(e,t={}){if(Array.isArray(e)||(e=n.REGISTERED_PARAMETERS[e]),u.validation){if(void 0===e)throw new TypeError("The specified registered parameter is invalid.");let t=!1;if(Object.getOwnPropertyNames(n.REGISTERED_PARAMETERS).forEach((s=>{n.REGISTERED_PARAMETERS[s][0]===e[0]&&n.REGISTERED_PARAMETERS[s][1]===e[1]&&(t=!0)})),!t)throw new TypeError("The specified registered parameter is invalid.")}return this._selectRegisteredParameter(e,t),this.sendControlChange(96,0,t),this._deselectRegisteredParameter(t),this}playNote(e,t={}){this.sendNoteOn(e,t);const n=Array.isArray(e)?e:[e];for(let e of n)if(parseInt(e.duration)>0){const n={time:(i.toTimestamp(t.time)||u.time)+parseInt(e.duration),release:e.release,rawRelease:e.rawRelease};this.sendNoteOff(e,n)}else if(parseInt(t.duration)>0){const n={time:(i.toTimestamp(t.time)||u.time)+parseInt(t.duration),release:t.release,rawRelease:t.rawRelease};this.sendNoteOff(e,n)}return this}sendNoteOff(e,t={}){if(u.validation){if(null!=t.rawRelease&&!(t.rawRelease>=0&&t.rawRelease<=127))throw new RangeError("The 'rawRelease' option must be an integer between 0 and 127");if(null!=t.release&&!(t.release>=0&&t.release<=1))throw new RangeError("The 'release' option must be an number between 0 and 1");t.rawVelocity&&(t.rawRelease=t.velocity,console.warn("The 'rawVelocity' option is deprecated. Use 'rawRelease' instead.")),t.velocity&&(t.release=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let s=64;null!=t.rawRelease?s=t.rawRelease:isNaN(t.release)||(s=Math.round(127*t.release));const r=u.octaveOffset+this.output.octaveOffset+this.octaveOffset;return i.buildNoteArray(e,{rawRelease:parseInt(s)}).forEach((e=>{this.send([(n.CHANNEL_MESSAGES.noteoff<<4)+(this.number-1),e.getOffsetNumber(r),e.rawRelease],{time:i.toTimestamp(t.time)})})),this}stopNote(e,t={}){return this.sendNoteOff(e,t)}sendNoteOn(e,t={}){if(u.validation){if(null!=t.rawAttack&&!(t.rawAttack>=0&&t.rawAttack<=127))throw new RangeError("The 'rawAttack' option must be an integer between 0 and 127");if(null!=t.attack&&!(t.attack>=0&&t.attack<=1))throw new RangeError("The 'attack' option must be an number between 0 and 1");t.rawVelocity&&(t.rawAttack=t.velocity,t.rawRelease=t.release,console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' or 'rawRelease'.")),t.velocity&&(t.attack=t.velocity,console.warn("The 'velocity' option is deprecated. Use 'attack' instead."))}let s=64;null!=t.rawAttack?s=t.rawAttack:isNaN(t.attack)||(s=Math.round(127*t.attack));const r=u.octaveOffset+this.output.octaveOffset+this.octaveOffset;return i.buildNoteArray(e,{rawAttack:s}).forEach((e=>{this.send([(n.CHANNEL_MESSAGES.noteon<<4)+(this.number-1),e.getOffsetNumber(r),e.rawAttack],{time:i.toTimestamp(t.time)})})),this}sendChannelMode(e,t=0,s={}){if("string"==typeof e&&(e=n.CHANNEL_MODE_MESSAGES[e]),u.validation){if(void 0===e)throw new TypeError("Invalid channel mode message name or number.");if(isNaN(e)||!(e>=120&&e<=127))throw new TypeError("Invalid channel mode message number.");if(isNaN(parseInt(t))||t<0||t>127)throw new RangeError("Value must be an integer between 0 and 127.")}return this.send([(n.CHANNEL_MESSAGES.controlchange<<4)+(this.number-1),e,t],{time:i.toTimestamp(s.time)}),this}sendOmniMode(e,t={}){return void 0===e||e?this.sendChannelMode("omnimodeon",0,t):this.sendChannelMode("omnimodeoff",0,t),this}sendChannelAftertouch(e,t={}){if(u.validation){if(isNaN(parseFloat(e)))throw new RangeError("Invalid channel aftertouch value.");if(t.rawValue){if(!(e>=0&&e<=127&&Number.isInteger(e)))throw new RangeError("Channel aftertouch raw value must be an integer between 0 and 127.")}else if(!(e>=0&&e<=1))throw new RangeError("Channel aftertouch value must be a float between 0 and 1.")}return t.rawValue||(e=i.fromFloatTo7Bit(e)),this.send([(n.CHANNEL_MESSAGES.channelaftertouch<<4)+(this.number-1),Math.round(e)],{time:i.toTimestamp(t.time)}),this}sendMasterTuning(e,t={}){if(e=parseFloat(e)||0,u.validation&&!(e>-65&&e<64))throw new RangeError("The value must be a decimal number larger than -65 and smaller than 64.");let n=Math.floor(e)+64,s=e-Math.floor(e);s=Math.round((s+1)/2*16383);let r=s>>7&127,i=127&s;return this.sendRpnValue("channelcoarsetuning",n,t),this.sendRpnValue("channelfinetuning",[r,i],t),this}sendModulationRange(e,t,n={}){if(u.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!(null==t||Number.isInteger(t)&&t>=0&&t<=127))throw new RangeError("If specified, the cents value must be an integer between 0 and 127.")}return t>=0&&t<=127||(t=0),this.sendRpnValue("modulationrange",[e,t],n),this}sendNrpnValue(e,t,n={}){if(t=[].concat(t),u.validation){if(!Array.isArray(e)||!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the NRPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the NRPN must be between 0 and 127.");t.forEach((e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the NRPN must be between 0 and 127.")}))}return this._selectNonRegisteredParameter(e,n),this._setCurrentParameter(t,n),this._deselectNonRegisteredParameter(n),this}sendPitchBend(e,t={}){if(u.validation)if(t.rawValue&&Array.isArray(e)){if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The pitch bend LSB must be an integer between 0 and 127.")}else if(t.rawValue&&!Array.isArray(e)){if(!(e>=0&&e<=127))throw new RangeError("The pitch bend MSB must be an integer between 0 and 127.")}else{if(isNaN(e)||null===e)throw new RangeError("Invalid pitch bend value.");if(!(e>=-1&&e<=1))throw new RangeError("The pitch bend value must be a float between -1 and 1.")}let s=0,r=0;if(t.rawValue&&Array.isArray(e))s=e[0],r=e[1];else if(t.rawValue&&!Array.isArray(e))s=e;else{const t=i.fromFloatToMsbLsb((e+1)/2);s=t.msb,r=t.lsb}return this.send([(n.CHANNEL_MESSAGES.pitchbend<<4)+(this.number-1),r,s],{time:i.toTimestamp(t.time)}),this}sendPitchBendRange(e,t,n={}){if(u.validation){if(!Number.isInteger(e)||!(e>=0&&e<=127))throw new RangeError("The semitones value must be an integer between 0 and 127.");if(!Number.isInteger(t)||!(t>=0&&t<=127))throw new RangeError("The cents value must be an integer between 0 and 127.")}return this.sendRpnValue("pitchbendrange",[e,t],n),this}sendProgramChange(e,t={}){if(e=parseInt(e)||0,u.validation&&!(e>=0&&e<=127))throw new RangeError("The program number must be between 0 and 127.");return this.send([(n.CHANNEL_MESSAGES.programchange<<4)+(this.number-1),e],{time:i.toTimestamp(t.time)}),this}sendRpnValue(e,t,s={}){if(Array.isArray(e)||(e=n.REGISTERED_PARAMETERS[e]),u.validation){if(!Number.isInteger(e[0])||!Number.isInteger(e[1]))throw new TypeError("The specified NRPN is invalid.");if(!(e[0]>=0&&e[0]<=127))throw new RangeError("The first byte of the RPN must be between 0 and 127.");if(!(e[1]>=0&&e[1]<=127))throw new RangeError("The second byte of the RPN must be between 0 and 127.");[].concat(t).forEach((e=>{if(!(e>=0&&e<=127))throw new RangeError("The data bytes of the RPN must be between 0 and 127.")}))}return this._selectRegisteredParameter(e,s),this._setCurrentParameter(t,s),this._deselectRegisteredParameter(s),this}sendTuningBank(e,t={}){if(u.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning bank number must be between 0 and 127.");return this.sendRpnValue("tuningbank",e,t),this}sendTuningProgram(e,t={}){if(u.validation&&(!Number.isInteger(e)||!(e>=0&&e<=127)))throw new RangeError("The tuning program number must be between 0 and 127.");return this.sendRpnValue("tuningprogram",e,t),this}sendLocalControl(e,t={}){return e?this.sendChannelMode("localcontrol",127,t):this.sendChannelMode("localcontrol",0,t)}sendAllNotesOff(e={}){return this.sendChannelMode("allnotesoff",0,e)}sendAllSoundOff(e={}){return this.sendChannelMode("allsoundoff",0,e)}sendResetAllControllers(e={}){return this.sendChannelMode("resetallcontrollers",0,e)}sendPolyphonicMode(e,t={}){return"mono"===e?this.sendChannelMode("monomodeon",0,t):this.sendChannelMode("polymodeon",0,t)}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get output(){return this._output}get number(){return this._number}}class o extends e{constructor(e){super(),this._midiOutput=e,this._octaveOffset=0,this.channels=[];for(let e=1;e<=16;e++)this.channels[e]=new a(this,e);this._midiOutput.onstatechange=this._onStateChange.bind(this)}async destroy(){this.removeListener(),this.channels.forEach((e=>e.destroy())),this.channels=[],this._midiOutput&&(this._midiOutput.onstatechange=null),await this.close(),this._midiOutput=null}_onStateChange(e){let t={timestamp:u.time};"open"===e.port.connection?(t.type="opened",t.target=this,t.port=t.target,this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",t.target=this,t.port=t.target,this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught:",e.port.connection,e.port.state)}async open(){try{return await this._midiOutput.open(),Promise.resolve(this)}catch(e){return Promise.reject(e)}}async close(){this._midiOutput?await this._midiOutput.close():await Promise.resolve()}send(e,t={time:0},n=0){if(e instanceof d&&(e=i.isNode?e.data:e.rawData),e instanceof Uint8Array&&i.isNode&&(e=Array.from(e)),u.validation){if(Array.isArray(e)||e instanceof Uint8Array||(e=[e],Array.isArray(t)&&(e=e.concat(t)),t=isNaN(n)?{time:0}:{time:n}),!(parseInt(e[0])>=128&&parseInt(e[0])<=255))throw new RangeError("The first byte (status) must be an integer between 128 and 255.");e.slice(1).forEach((e=>{if(!((e=parseInt(e))>=0&&e<=255))throw new RangeError("Data bytes must be integers between 0 and 255.")})),t||(t={time:0})}return this._midiOutput.send(e,i.toTimestamp(t.time)),this}sendSysex(e,t=[],s={}){if(e=[].concat(e),t instanceof Uint8Array){const r=new Uint8Array(1+e.length+t.length+1);r[0]=n.SYSTEM_MESSAGES.sysex,r.set(Uint8Array.from(e),1),r.set(t,1+e.length),r[r.length-1]=n.SYSTEM_MESSAGES.sysexend,this.send(r,{time:s.time})}else{const r=e.concat(t,n.SYSTEM_MESSAGES.sysexend);this.send([n.SYSTEM_MESSAGES.sysex].concat(r),{time:s.time})}return this}clear(){return this._midiOutput.clear?this._midiOutput.clear():u.validation&&console.warn("The 'clear()' method has not yet been implemented in your environment."),this}sendTimecodeQuarterFrame(e,t={}){if(u.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The value must be an integer between 0 and 127.");return this.send([n.SYSTEM_MESSAGES.timecode,e],{time:t.time}),this}sendSongPosition(e=0,t={}){var s=(e=Math.floor(e)||0)>>7&127,r=127&e;return this.send([n.SYSTEM_MESSAGES.songposition,s,r],{time:t.time}),this}sendSongSelect(e=0,t={}){if(u.validation&&(e=parseInt(e),isNaN(e)||!(e>=0&&e<=127)))throw new RangeError("The program value must be between 0 and 127");return this.send([n.SYSTEM_MESSAGES.songselect,e],{time:t.time}),this}sendTuneRequest(e={}){return this.send([n.SYSTEM_MESSAGES.tunerequest],{time:e.time}),this}sendClock(e={}){return this.send([n.SYSTEM_MESSAGES.clock],{time:e.time}),this}sendStart(e={}){return this.send([n.SYSTEM_MESSAGES.start],{time:e.time}),this}sendContinue(e={}){return this.send([n.SYSTEM_MESSAGES.continue],{time:e.time}),this}sendStop(e={}){return this.send([n.SYSTEM_MESSAGES.stop],{time:e.time}),this}sendActiveSensing(e={}){return this.send([n.SYSTEM_MESSAGES.activesensing],{time:e.time}),this}sendReset(e={}){return this.send([n.SYSTEM_MESSAGES.reset],{time:e.time}),this}sendTuningRequest(e={}){return u.validation&&console.warn("The sendTuningRequest() method has been deprecated. Use sendTuningRequest() instead."),this.sendTuneRequest(e)}sendKeyAftertouch(e,t,s={}){return null==s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(s.channels).forEach((n=>{this.channels[n].sendKeyAftertouch(e,t,s)})),this}sendControlChange(e,t,s={},r={}){if(u.validation&&(Array.isArray(s)||Number.isInteger(s)||"all"===s)){const e=s;(s=r).channels=e,"all"===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS)}return null==s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(s.channels).forEach((n=>{this.channels[n].sendControlChange(e,t,s)})),this}sendPitchBendRange(e=0,t=0,s={}){return null==s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(s.channels).forEach((n=>{this.channels[n].sendPitchBendRange(e,t,s)})),this}setPitchBendRange(e=0,t=0,s="all",r={}){return u.validation&&(console.warn("The setPitchBendRange() method is deprecated. Use sendPitchBendRange() instead."),r.channels=s,"all"===r.channels&&(r.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendPitchBendRange(e,t,r)}sendRpnValue(e,t,s={}){return null==s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(s.channels).forEach((n=>{this.channels[n].sendRpnValue(e,t,s)})),this}setRegisteredParameter(e,t=[],s="all",r={}){return u.validation&&(console.warn("The setRegisteredParameter() method is deprecated. Use sendRpnValue() instead."),r.channels=s,"all"===r.channels&&(r.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendRpnValue(e,t,r)}sendChannelAftertouch(e,t={},s={}){if(u.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendChannelAftertouch(e,t)})),this}sendPitchBend(e,t={},s={}){if(u.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendPitchBend(e,t)})),this}sendProgramChange(e=0,t={},s={}){if(u.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendProgramChange(e,t)})),this}sendModulationRange(e,t,s={}){return null==s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(s.channels).forEach((n=>{this.channels[n].sendModulationRange(e,t,s)})),this}setModulationRange(e=0,t=0,s="all",r={}){return u.validation&&(console.warn("The setModulationRange() method is deprecated. Use sendModulationRange() instead."),r.channels=s,"all"===r.channels&&(r.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendModulationRange(e,t,r)}sendMasterTuning(e,t={}){return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendMasterTuning(e,t)})),this}setMasterTuning(e,t={},s={}){return u.validation&&(console.warn("The setMasterTuning() method is deprecated. Use sendMasterTuning() instead."),s.channels=t,"all"===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendMasterTuning(e,s)}sendTuningProgram(e,t={}){return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendTuningProgram(e,t)})),this}setTuningProgram(e,t="all",s={}){return u.validation&&(console.warn("The setTuningProgram() method is deprecated. Use sendTuningProgram() instead."),s.channels=t,"all"===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendTuningProgram(e,s)}sendTuningBank(e=0,t={}){return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendTuningBank(e,t)})),this}setTuningBank(e,t="all",s={}){return u.validation&&(console.warn("The setTuningBank() method is deprecated. Use sendTuningBank() instead."),s.channels=t,"all"===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendTuningBank(e,s)}sendChannelMode(e,t=0,s={},r={}){if(u.validation&&(Array.isArray(s)||Number.isInteger(s)||"all"===s)){const e=s;(s=r).channels=e,"all"===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS)}return null==s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(s.channels).forEach((n=>{this.channels[n].sendChannelMode(e,t,s)})),this}sendAllSoundOff(e={}){return null==e.channels&&(e.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendAllSoundOff(e)})),this}sendAllNotesOff(e={}){return null==e.channels&&(e.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendAllNotesOff(e)})),this}sendResetAllControllers(e={},t={}){if(u.validation&&(Array.isArray(e)||Number.isInteger(e)||"all"===e)){const s=e;(e=t).channels=s,"all"===e.channels&&(e.channels=n.MIDI_CHANNEL_NUMBERS)}return null==e.channels&&(e.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(e.channels).forEach((t=>{this.channels[t].sendResetAllControllers(e)})),this}sendPolyphonicMode(e,t={},s={}){if(u.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendPolyphonicMode(e,t)})),this}sendLocalControl(e,t={},s={}){if(u.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendLocalControl(e,t)})),this}sendOmniMode(e,t={},s={}){if(u.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendOmniMode(e,t)})),this}sendNrpnValue(e,t,s={}){return null==s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(s.channels).forEach((n=>{this.channels[n].sendNrpnValue(e,t,s)})),this}setNonRegisteredParameter(e,t=[],s="all",r={}){return u.validation&&(console.warn("The setNonRegisteredParameter() method is deprecated. Use sendNrpnValue() instead."),r.channels=s,"all"===r.channels&&(r.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendNrpnValue(e,t,r)}sendRpnIncrement(e,t={}){return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendRpnIncrement(e,t)})),this}incrementRegisteredParameter(e,t="all",s={}){return u.validation&&(console.warn("The incrementRegisteredParameter() method is deprecated. Use sendRpnIncrement() instead."),s.channels=t,"all"===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendRpnIncrement(e,s)}sendRpnDecrement(e,t={}){return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendRpnDecrement(e,t)})),this}decrementRegisteredParameter(e,t="all",s={}){return u.validation&&(console.warn("The decrementRegisteredParameter() method is deprecated. Use sendRpnDecrement() instead."),s.channels=t,"all"===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS)),this.sendRpnDecrement(e,s)}sendNoteOff(e,t={},s={}){if(u.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendNoteOff(e,t)})),this}stopNote(e,t){return this.sendNoteOff(e,t)}playNote(e,t={},s={}){if(u.validation&&(t.rawVelocity&&console.warn("The 'rawVelocity' option is deprecated. Use 'rawAttack' instead."),t.velocity&&console.warn("The 'velocity' option is deprecated. Use 'velocity' instead."),Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].playNote(e,t)})),this}sendNoteOn(e,t={},s={}){if(u.validation&&(Array.isArray(t)||Number.isInteger(t)||"all"===t)){const e=t;(t=s).channels=e,"all"===t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS)}return null==t.channels&&(t.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(t.channels).forEach((n=>{this.channels[n].sendNoteOn(e,t)})),this}get name(){return this._midiOutput.name}get id(){return this._midiOutput.id}get connection(){return this._midiOutput.connection}get manufacturer(){return this._midiOutput.manufacturer}get state(){return this._midiOutput.state}get type(){return this._midiOutput.type}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}}class l{constructor(e=[],t={}){this.destinations=[],this.types=[...Object.keys(n.SYSTEM_MESSAGES),...Object.keys(n.CHANNEL_MESSAGES)],this.channels=n.MIDI_CHANNEL_NUMBERS,this.suspended=!1,Array.isArray(e)||(e=[e]),t.types&&!Array.isArray(t.types)&&(t.types=[t.types]),t.channels&&!Array.isArray(t.channels)&&(t.channels=[t.channels]),u.validation&&(e.forEach((e=>{if(!(e instanceof o))throw new TypeError("Destinations must be of type 'Output'.")})),void 0!==t.types&&t.types.forEach((e=>{if(!n.SYSTEM_MESSAGES.hasOwnProperty(e)&&!n.CHANNEL_MESSAGES.hasOwnProperty(e))throw new TypeError("Type must be a valid message type.")})),void 0!==t.channels&&t.channels.forEach((e=>{if(!n.MIDI_CHANNEL_NUMBERS.includes(e))throw new TypeError("MIDI channel must be between 1 and 16.")}))),this.destinations=e,t.types&&(this.types=t.types),t.channels&&(this.channels=t.channels)}forward(e){this.suspended||this.types.includes(e.type)&&(e.channel&&!this.channels.includes(e.channel)||this.destinations.forEach((t=>{(!u.validation||t instanceof o)&&t.send(e)})))}}class c extends e{constructor(e,t){super(),this._input=e,this._number=t,this._octaveOffset=0,this._nrpnBuffer=[],this._rpnBuffer=[],this.parameterNumberEventsEnabled=!0,this.notesState=new Array(128).fill(!1)}destroy(){this._input=null,this._number=null,this._octaveOffset=0,this._nrpnBuffer=[],this.notesState=new Array(128).fill(!1),this.parameterNumberEventsEnabled=!1,this.removeListener()}_processMidiMessageEvent(e){const t=Object.assign({},e);t.port=this.input,t.target=this,t.type="midimessage",this.emit(t.type,t),this._parseEventForStandardMessages(t)}_parseEventForStandardMessages(e){const t=Object.assign({},e);t.type=t.message.type||"unknownmessage";const r=e.message.dataBytes[0],a=e.message.dataBytes[1];if("noteoff"===t.type||"noteon"===t.type&&0===a)this.notesState[r]=!1,t.type="noteoff",t.note=new s(i.offsetNumber(r,this.octaveOffset+this.input.octaveOffset+u.octaveOffset),{rawAttack:0,rawRelease:a}),t.value=i.from7bitToFloat(a),t.rawValue=a,t.velocity=t.note.release,t.rawVelocity=t.note.rawRelease;else if("noteon"===t.type)this.notesState[r]=!0,t.note=new s(i.offsetNumber(r,this.octaveOffset+this.input.octaveOffset+u.octaveOffset),{rawAttack:a}),t.value=i.from7bitToFloat(a),t.rawValue=a,t.velocity=t.note.attack,t.rawVelocity=t.note.rawAttack;else if("keyaftertouch"===t.type)t.note=new s(i.offsetNumber(r,this.octaveOffset+this.input.octaveOffset+u.octaveOffset)),t.value=i.from7bitToFloat(a),t.rawValue=a,t.identifier=t.note.identifier,t.key=t.note.number,t.rawKey=r;else if("controlchange"===t.type){t.controller={number:r,name:n.CONTROL_CHANGE_MESSAGES[r].name,description:n.CONTROL_CHANGE_MESSAGES[r].description,position:n.CONTROL_CHANGE_MESSAGES[r].position},t.subtype=t.controller.name||"controller"+r,t.value=i.from7bitToFloat(a),t.rawValue=a;const e=Object.assign({},t);e.type=`${t.type}-controller${r}`,delete e.subtype,this.emit(e.type,e);const s=Object.assign({},t);s.type=`${t.type}-`+n.CONTROL_CHANGE_MESSAGES[r].name,delete s.subtype,0!==s.type.indexOf("controller")&&this.emit(s.type,s),t.message.dataBytes[0]>=120&&this._parseChannelModeMessage(t),this.parameterNumberEventsEnabled&&this._isRpnOrNrpnController(t.message.dataBytes[0])&&this._parseEventForParameterNumber(t)}else"programchange"===t.type?(t.value=r,t.rawValue=t.value):"channelaftertouch"===t.type?(t.value=i.from7bitToFloat(r),t.rawValue=r):"pitchbend"===t.type?(t.value=((a<<7)+r-8192)/8192,t.rawValue=(a<<7)+r):t.type="unknownmessage";this.emit(t.type,t)}_parseChannelModeMessage(e){const t=Object.assign({},e);t.type=t.controller.name,"localcontrol"===t.type&&(t.value=127===t.message.data[2],t.rawValue=t.message.data[2]),"omnimodeon"===t.type?(t.type="omnimode",t.value=!0,t.rawValue=t.message.data[2]):"omnimodeoff"===t.type&&(t.type="omnimode",t.value=!1,t.rawValue=t.message.data[2]),"monomodeon"===t.type?(t.type="monomode",t.value=!0,t.rawValue=t.message.data[2]):"polymodeon"===t.type&&(t.type="monomode",t.value=!1,t.rawValue=t.message.data[2]),this.emit(t.type,t)}_parseEventForParameterNumber(e){const t=e.message.dataBytes[0],n=e.message.dataBytes[1];99===t||101===t?(this._nrpnBuffer=[],this._rpnBuffer=[],99===t?this._nrpnBuffer=[e.message]:127!==n&&(this._rpnBuffer=[e.message])):98===t||100===t?98===t?(this._rpnBuffer=[],1===this._nrpnBuffer.length?this._nrpnBuffer.push(e.message):this._nrpnBuffer=[]):(this._nrpnBuffer=[],1===this._rpnBuffer.length&&127!==n?this._rpnBuffer.push(e.message):this._rpnBuffer=[]):6!==t&&38!==t&&96!==t&&97!==t||(2===this._rpnBuffer.length?this._dispatchParameterNumberEvent("rpn",this._rpnBuffer[0].dataBytes[1],this._rpnBuffer[1].dataBytes[1],e):2===this._nrpnBuffer.length?this._dispatchParameterNumberEvent("nrpn",this._nrpnBuffer[0].dataBytes[1],this._nrpnBuffer[1].dataBytes[1],e):(this._nrpnBuffer=[],this._rpnBuffer=[]))}_isRpnOrNrpnController(e){return 6===e||38===e||96===e||97===e||98===e||99===e||100===e||101===e}_dispatchParameterNumberEvent(e,t,s,r){e="nrpn"===e?"nrpn":"rpn";const a={target:r.target,timestamp:r.timestamp,message:r.message,parameterMsb:t,parameterLsb:s,value:i.from7bitToFloat(r.message.dataBytes[1]),rawValue:r.message.dataBytes[1]};a.parameter="rpn"===e?Object.keys(n.REGISTERED_PARAMETERS).find((e=>n.REGISTERED_PARAMETERS[e][0]===t&&n.REGISTERED_PARAMETERS[e][1]===s)):(t<<7)+s;const o=n.CONTROL_CHANGE_MESSAGES[r.message.dataBytes[0]].name;a.type=`${e}-${o}`,this.emit(a.type,a);const l=Object.assign({},a);"nrpn-dataincrement"===l.type?l.type="nrpn-databuttonincrement":"nrpn-datadecrement"===l.type?l.type="nrpn-databuttondecrement":"rpn-dataincrement"===l.type?l.type="rpn-databuttonincrement":"rpn-datadecrement"===l.type&&(l.type="rpn-databuttondecrement"),this.emit(l.type,l),a.type=e,a.subtype=o,this.emit(a.type,a)}getChannelModeByNumber(e){return u.validation&&(console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class."),e=Math.floor(e)),i.getChannelModeByNumber(e)}getCcNameByNumber(e){if(u.validation&&(console.warn("The 'getCcNameByNumber()' method has been moved to the 'Utilities' class."),!((e=parseInt(e))>=0&&e<=127)))throw new RangeError("Invalid control change number.");return i.getCcNameByNumber(e)}getNoteState(e){e instanceof s&&(e=e.identifier);const t=i.guessNoteNumber(e,u.octaveOffset+this.input.octaveOffset+this.octaveOffset);return this.notesState[t]}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get input(){return this._input}get number(){return this._number}get nrpnEventsEnabled(){return this.parameterNumberEventsEnabled}set nrpnEventsEnabled(e){this.validation&&(e=!!e),this.parameterNumberEventsEnabled=e}}class d{constructor(e){this.rawData=e,this.data=Array.from(this.rawData),this.statusByte=this.rawData[0],this.rawDataBytes=this.rawData.slice(1),this.dataBytes=this.data.slice(1),this.isChannelMessage=!1,this.isSystemMessage=!1,this.command=void 0,this.channel=void 0,this.manufacturerId=void 0,this.type=void 0,this.statusByte<240?(this.isChannelMessage=!0,this.command=this.statusByte>>4,this.channel=1+(15&this.statusByte)):(this.isSystemMessage=!0,this.command=this.statusByte),this.isChannelMessage?this.type=i.getPropertyByValue(n.CHANNEL_MESSAGES,this.command):this.isSystemMessage&&(this.type=i.getPropertyByValue(n.SYSTEM_MESSAGES,this.command)),this.statusByte===n.SYSTEM_MESSAGES.sysex&&(0===this.dataBytes[0]?(this.manufacturerId=this.dataBytes.slice(0,3),this.dataBytes=this.dataBytes.slice(3,this.rawDataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(3,this.rawDataBytes.length-1)):(this.manufacturerId=[this.dataBytes[0]],this.dataBytes=this.dataBytes.slice(1,this.dataBytes.length-1),this.rawDataBytes=this.rawDataBytes.slice(1,this.rawDataBytes.length-1)))}}class h extends e{constructor(e){super(),this._midiInput=e,this._octaveOffset=0,this.channels=[];for(let e=1;e<=16;e++)this.channels[e]=new c(this,e);this._forwarders=[],this._midiInput.onstatechange=this._onStateChange.bind(this),this._midiInput.onmidimessage=this._onMidiMessage.bind(this)}async destroy(){this.removeListener(),this.channels.forEach((e=>e.destroy())),this.channels=[],this._forwarders=[],this._midiInput&&(this._midiInput.onstatechange=null,this._midiInput.onmidimessage=null),await this.close(),this._midiInput=null}_onStateChange(e){let t={timestamp:u.time,target:this,port:this};"open"===e.port.connection?(t.type="opened",this.emit("opened",t)):"closed"===e.port.connection&&"connected"===e.port.state?(t.type="closed",this.emit("closed",t)):"closed"===e.port.connection&&"disconnected"===e.port.state?(t.type="disconnected",t.port={connection:e.port.connection,id:e.port.id,manufacturer:e.port.manufacturer,name:e.port.name,state:e.port.state,type:e.port.type},this.emit("disconnected",t)):"pending"===e.port.connection&&"disconnected"===e.port.state||console.warn("This statechange event was not caught: ",e.port.connection,e.port.state)}_onMidiMessage(e){const t=new d(e.data),n={port:this,target:this,message:t,timestamp:e.timeStamp,type:"midimessage",data:t.data,rawData:t.data,statusByte:t.data[0],dataBytes:t.dataBytes};this.emit("midimessage",n),t.isSystemMessage?this._parseEvent(n):t.isChannelMessage&&this.channels[t.channel]._processMidiMessageEvent(n),this._forwarders.forEach((e=>e.forward(t)))}_parseEvent(e){const t=Object.assign({},e);t.type=t.message.type||"unknownmidimessage","songselect"===t.type&&(t.song=e.data[1]+1,t.value=e.data[1],t.rawValue=t.value),this.emit(t.type,t)}async open(){try{await this._midiInput.open()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}async close(){if(!this._midiInput)return Promise.resolve(this);try{await this._midiInput.close()}catch(e){return Promise.reject(e)}return Promise.resolve(this)}getChannelModeByNumber(){u.validation&&console.warn("The 'getChannelModeByNumber()' method has been moved to the 'Utilities' class.")}addListener(e,t,s={}){if(u.validation&&"function"==typeof s){let e=null!=t?[].concat(t):void 0;t=s,s={channels:e}}if(n.CHANNEL_EVENTS.includes(e)){void 0===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS);let r=[];return i.sanitizeChannels(s.channels).forEach((n=>{r.push(this.channels[n].addListener(e,t,s))})),r}return super.addListener(e,t,s)}addOneTimeListener(e,t,n={}){return n.remaining=1,this.addListener(e,t,n)}on(e,t,n,s){return this.addListener(e,t,n,s)}hasListener(e,t,s={}){if(u.validation&&"function"==typeof s){let e=[].concat(t);t=s,s={channels:e}}return n.CHANNEL_EVENTS.includes(e)?(void 0===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),i.sanitizeChannels(s.channels).every((n=>this.channels[n].hasListener(e,t)))):super.hasListener(e,t)}removeListener(e,t,s={}){if(u.validation&&"function"==typeof s){let e=[].concat(t);t=s,s={channels:e}}if(void 0===s.channels&&(s.channels=n.MIDI_CHANNEL_NUMBERS),null==e)return i.sanitizeChannels(s.channels).forEach((e=>{this.channels[e]&&this.channels[e].removeListener()})),super.removeListener();n.CHANNEL_EVENTS.includes(e)?i.sanitizeChannels(s.channels).forEach((n=>{this.channels[n].removeListener(e,t,s)})):super.removeListener(e,t,s)}addForwarder(e,t={}){let n;return n=e instanceof l?e:new l(e,t),this._forwarders.push(n),n}removeForwarder(e){this._forwarders=this._forwarders.filter((t=>t!==e))}hasForwarder(e){return this._forwarders.includes(e)}get name(){return this._midiInput.name}get id(){return this._midiInput.id}get connection(){return this._midiInput.connection}get manufacturer(){return this._midiInput.manufacturer}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get state(){return this._midiInput.state}get type(){return this._midiInput.type}get nrpnEventsEnabled(){return u.validation&&console.warn("The 'nrpnEventsEnabled' property has been moved to the 'InputChannel' class."),!1}}const u=new class extends e{constructor(){super(),this.defaults={note:{attack:i.from7bitToFloat(64),release:i.from7bitToFloat(64),duration:1/0}},this.interface=null,this.validation=!0,this._inputs=[],this._disconnectedInputs=[],this._outputs=[],this._disconnectedOutputs=[],this._stateChangeQueue=[],this._octaveOffset=0}async enable(e={},t=!1){if(i.isNode){try{window.navigator}catch(e){let t=await Object.getPrototypeOf((async function(){})).constructor('\n        let jzz = await import("jzz");\n        return jzz.default;\n        ')();global.navigator||(global.navigator={}),Object.assign(global.navigator,t)}try{performance}catch(e){global.performance=await Object.getPrototypeOf((async function(){})).constructor('\n        let perf_hooks = await import("perf_hooks");\n        return perf_hooks.performance;\n        ')()}}if(this.validation=!1!==e.validation,this.validation&&("function"==typeof e&&(e={callback:e,sysex:t}),t&&(e.sysex=!0)),this.enabled)return"function"==typeof e.callback&&e.callback(),Promise.resolve();const n={timestamp:this.time,target:this,type:"error",error:void 0},s={timestamp:this.time,target:this,type:"midiaccessgranted"},r={timestamp:this.time,target:this,type:"enabled"};try{"function"==typeof e.requestMIDIAccessFunction?this.interface=await e.requestMIDIAccessFunction({sysex:e.sysex,software:e.software}):this.interface=await navigator.requestMIDIAccess({sysex:e.sysex,software:e.software})}catch(t){return n.error=t,this.emit("error",n),"function"==typeof e.callback&&e.callback(t),Promise.reject(t)}this.emit("midiaccessgranted",s),this.interface.onstatechange=this._onInterfaceStateChange.bind(this);try{await this._updateInputsAndOutputs()}catch(t){return n.error=t,this.emit("error",n),"function"==typeof e.callback&&e.callback(t),Promise.reject(t)}return this.emit("enabled",r),"function"==typeof e.callback&&e.callback(),Promise.resolve(this)}async disable(){return this.interface&&(this.interface.onstatechange=void 0),this._destroyInputsAndOutputs().then((()=>{navigator&&"function"==typeof navigator.close&&navigator.close(),this.interface=null;let e={timestamp:this.time,target:this,type:"disabled"};this.emit("disabled",e),this.removeListener()}))}getInputById(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(t.disconnected){for(let t=0;t<this._disconnectedInputs.length;t++)if(this._disconnectedInputs[t].id===e.toString())return this._disconnectedInputs[t]}else for(let t=0;t<this.inputs.length;t++)if(this.inputs[t].id===e.toString())return this.inputs[t]}getInputByName(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(t.disconnected){for(let t=0;t<this._disconnectedInputs.length;t++)if(~this._disconnectedInputs[t].name.indexOf(e))return this._disconnectedInputs[t]}else for(let t=0;t<this.inputs.length;t++)if(~this.inputs[t].name.indexOf(e))return this.inputs[t]}getOutputByName(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return;e=e.toString()}if(t.disconnected){for(let t=0;t<this._disconnectedOutputs.length;t++)if(~this._disconnectedOutputs[t].name.indexOf(e))return this._disconnectedOutputs[t]}else for(let t=0;t<this.outputs.length;t++)if(~this.outputs[t].name.indexOf(e))return this.outputs[t]}getOutputById(e,t={disconnected:!1}){if(this.validation){if(!this.enabled)throw new Error("WebMidi is not enabled.");if(!e)return}if(t.disconnected){for(let t=0;t<this._disconnectedOutputs.length;t++)if(this._disconnectedOutputs[t].id===e.toString())return this._disconnectedOutputs[t]}else for(let t=0;t<this.outputs.length;t++)if(this.outputs[t].id===e.toString())return this.outputs[t]}noteNameToNumber(e){return this.validation&&console.warn("The noteNameToNumber() method is deprecated. Use Utilities.toNoteNumber() instead."),i.toNoteNumber(e,this.octaveOffset)}getOctave(e){return this.validation&&(console.warn("The getOctave()is deprecated. Use Utilities.getNoteDetails() instead"),e=parseInt(e)),!isNaN(e)&&e>=0&&e<=127&&i.getNoteDetails(i.offsetNumber(e,this.octaveOffset)).octave}sanitizeChannels(e){return this.validation&&console.warn("The sanitizeChannels() method has been moved to the utilities class."),i.sanitizeChannels(e)}toMIDIChannels(e){return this.validation&&console.warn("The toMIDIChannels() method has been deprecated. Use Utilities.sanitizeChannels() instead."),i.sanitizeChannels(e)}guessNoteNumber(e){return this.validation&&console.warn("The guessNoteNumber() method has been deprecated. Use Utilities.guessNoteNumber() instead."),i.guessNoteNumber(e,this.octaveOffset)}getValidNoteArray(e,t={}){return this.validation&&console.warn("The getValidNoteArray() method has been moved to the Utilities.buildNoteArray()"),i.buildNoteArray(e,t)}convertToTimestamp(e){return this.validation&&console.warn("The convertToTimestamp() method has been moved to Utilities.toTimestamp()."),i.toTimestamp(e)}async _destroyInputsAndOutputs(){let e=[];return this.inputs.forEach((t=>e.push(t.destroy()))),this.outputs.forEach((t=>e.push(t.destroy()))),Promise.all(e).then((()=>{this._inputs=[],this._outputs=[]}))}_onInterfaceStateChange(e){this._updateInputsAndOutputs();let t={timestamp:e.timeStamp,type:e.port.state,target:this};if("connected"===e.port.state&&"open"===e.port.connection){"output"===e.port.type?t.port=this.getOutputById(e.port.id):"input"===e.port.type&&(t.port=this.getInputById(e.port.id)),this.emit(e.port.state,t);const n=Object.assign({},t);n.type="portschanged",this.emit(n.type,n)}else if("disconnected"===e.port.state&&"pending"===e.port.connection){"input"===e.port.type?t.port=this.getInputById(e.port.id,{disconnected:!0}):"output"===e.port.type&&(t.port=this.getOutputById(e.port.id,{disconnected:!0})),this.emit(e.port.state,t);const n=Object.assign({},t);n.type="portschanged",this.emit(n.type,n)}}async _updateInputsAndOutputs(){return Promise.all([this._updateInputs(),this._updateOutputs()])}async _updateInputs(){if(!this.interface)return;for(let e=this._inputs.length-1;e>=0;e--){const t=this._inputs[e];Array.from(this.interface.inputs.values()).find((e=>e===t._midiInput))||(this._disconnectedInputs.push(t),this._inputs.splice(e,1))}let e=[];return this.interface.inputs.forEach((t=>{if(!this._inputs.find((e=>e._midiInput===t))){let n=this._disconnectedInputs.find((e=>e._midiInput===t));n||(n=new h(t)),this._inputs.push(n),e.push(n.open())}})),Promise.all(e)}async _updateOutputs(){if(!this.interface)return;for(let e=this._outputs.length-1;e>=0;e--){const t=this._outputs[e];Array.from(this.interface.outputs.values()).find((e=>e===t._midiOutput))||(this._disconnectedOutputs.push(t),this._outputs.splice(e,1))}let e=[];return this.interface.outputs.forEach((t=>{if(!this._outputs.find((e=>e._midiOutput===t))){let n=this._disconnectedOutputs.find((e=>e._midiOutput===t));n||(n=new o(t)),this._outputs.push(n),e.push(n.open())}})),Promise.all(e)}get enabled(){return null!==this.interface}get inputs(){return this._inputs}get isNode(){return this.validation&&console.warn("WebMidi.isNode has been deprecated. Use Utilities.isNode instead."),i.isNode}get isBrowser(){return this.validation&&console.warn("WebMidi.isBrowser has been deprecated. Use Utilities.isBrowser instead."),i.isBrowser}get octaveOffset(){return this._octaveOffset}set octaveOffset(e){if(this.validation&&(e=parseInt(e),isNaN(e)))throw new TypeError("The 'octaveOffset' property must be an integer.");this._octaveOffset=e}get outputs(){return this._outputs}get supported(){return"undefined"!=typeof navigator&&!!navigator.requestMIDIAccess}get sysexEnabled(){return!(!this.interface||!this.interface.sysexEnabled)}get time(){return performance.now()}get version(){return"3.1.12"}get flavour(){return"esm"}get CHANNEL_EVENTS(){return this.validation&&console.warn("The CHANNEL_EVENTS enum has been moved to Enumerations.CHANNEL_EVENTS."),n.CHANNEL_EVENTS}get MIDI_SYSTEM_MESSAGES(){return this.validation&&console.warn("The MIDI_SYSTEM_MESSAGES enum has been moved to Enumerations.SYSTEM_MESSAGES."),n.SYSTEM_MESSAGES}get MIDI_CHANNEL_MODE_MESSAGES(){return this.validation&&console.warn("The MIDI_CHANNEL_MODE_MESSAGES enum has been moved to Enumerations.CHANNEL_MODE_MESSAGES."),n.CHANNEL_MODE_MESSAGES}get MIDI_CONTROL_CHANGE_MESSAGES(){return this.validation&&console.warn("The MIDI_CONTROL_CHANGE_MESSAGES enum has been replaced by the Enumerations.CONTROL_CHANGE_MESSAGES array."),n.MIDI_CONTROL_CHANGE_MESSAGES}get MIDI_REGISTERED_PARAMETER(){return this.validation&&console.warn("The MIDI_REGISTERED_PARAMETER enum has been moved to Enumerations.REGISTERED_PARAMETERS."),n.REGISTERED_PARAMETERS}get NOTES(){return this.validation&&console.warn("The NOTES enum has been deprecated."),["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"]}};u.constructor=null;var m=r(758);!function(){if("undefined"!=typeof window&&void 0!==window.Reflect&&void 0!==window.customElements){var e=HTMLElement;window.HTMLElement=function(){return Reflect.construct(e,[],this.constructor)},HTMLElement.prototype=e.prototype,HTMLElement.prototype.constructor=HTMLElement,Object.setPrototypeOf(HTMLElement,e)}}();var p=r(894);class f{constructor(e){this.tonnetz=e,this.sustainThreshold=43,this.sustained=!1,this.onNoteOn=e=>{var t;let n=null===(t=this.tonnetz.activeNotes)||void 0===t?void 0:t[e.note.number%p.S];n||(n=[],this.tonnetz.activeNotes[e.note.number%p.S]=n),n.push({state:p.N.PRESSED}),this.tonnetz.activeNotes=Object.assign({},this.tonnetz.activeNotes)},this.onNoteOff=e=>{var t;let n=null===(t=this.tonnetz.activeNotes)||void 0===t?void 0:t[e.note.number%p.S];if(n.length){if(this.sustained){const e=n.find((e=>e.state===p.N.PRESSED));e&&(e.state=p.N.SUSTAINED)}else n.shift();this.tonnetz.activeNotes=Object.assign({},this.tonnetz.activeNotes)}},this.onControlchange=e=>{if("damperpedal"===e.subtype&&(this.sustained=e.rawValue>this.sustainThreshold,!this.sustained&&this.tonnetz.activeNotes)){for(let e in this.tonnetz.activeNotes){let t=this.tonnetz.activeNotes[e];this.tonnetz.activeNotes[e]=t.filter((e=>e.state!==p.N.SUSTAINED))}this.tonnetz.activeNotes=Object.assign({},this.tonnetz.activeNotes)}}}listen(e){e.addListener("noteon",this.onNoteOn),e.addListener("noteoff",this.onNoteOff),e.addListener("controlchange",this.onControlchange)}unlisten(e){e.removeListener("noteon",this.onNoteOn),e.removeListener("noteoff",this.onNoteOff),e.removeListener("controlchange",this.onControlchange)}}class g extends HTMLElement{connectedCallback(){(async()=>{"undefined"!=typeof window&&(await void 0,(0,m.b)([["tiny-tonnetz_2",[[1,"tiny-tonnetz",{activeNotes:[1040],centralClusterMargin:[2,"central-cluster-margin"],iscontrolsVisible:[4,"controls"],isScalingEnabled:[4,"scaling"],scale:[1026],isLightTheme:[1028,"force-light-theme"],isDarkTheme:[1028,"force-dark-theme"],isTracing:[1028,"trace"],isTracingPlayedNote:[1028,"trace-played-notes"],noteNamingConvention:[1025,"note-naming-convention"],noteNamingConventionOptions:[16],hasNoTransition:[32],size:[32]},[[1,"wheel","handleScroll"]],{scale:["clampScale"],centralClusterMargin:["updateCentralClusterMargin"]}],[0,"tiny-tonnetz-cell",{cellStates:[8,"cell-states"],width:[2],height:[2],semiToneCode:[2,"semi-tone-code"],noteNamingConvention:[1,"note-naming-convention"],isTracing:[4,"is-tracing"],hasNoTransition:[4,"has-no-transition"]}]]]],void 0))})();const e=document.createElement("tiny-tonnetz");e.isLightTheme=!0,e.style.position="absolute",e.style.inset="0",e.style.aspectRatio="auto",this.appendChild(e);const t=new f(e);u.enable().then((()=>{u.inputs.length<1&&console.log("No device detected.")})).catch((e=>alert(e))),u.addListener("connected",(e=>{"input"===e.port.type&&(console.log(`[${e.port.id} connected] ${e.port.name}`),t.listen(e.port))})),u.addListener("disconnected",(e=>{"input"===e.port.type&&(console.log(`[${e.port.id} disconnected] ${e.port.name}`),t.unlisten(e.port))}))}}customElements.define("app-root",g)})()})();</script></body></html>